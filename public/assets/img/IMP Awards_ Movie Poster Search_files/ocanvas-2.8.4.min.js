!function(l,d,C){var y={version:"2.10.0",canvasList:[],modules:{},inits:{},plugins:{},core:function(t){for(var e in this.isCore=!0,this.id=y.canvasList.push(this)-1,this.lastObjectID=0,this.children=[],this.domEventHandlers=[],y.modules)"function"==typeof y.modules[e]?this[e]=y.modules[e]():this[e]=Object.create(y.modules[e]);if(this.settings={fps:30,background:"transparent",clearEachFrame:!0,drawEachFrame:!0,disableScrolling:!1,plugins:[]},y.extend(this.settings,t),this.originalSettings=y.extend({},this.settings),this.settings.canvas.nodeName&&"canvas"===this.settings.canvas.nodeName.toLowerCase())this.canvasElement=this.settings.canvas;else{if("string"!=typeof this.settings.canvas)return!1;this.canvasElement=d.querySelector(this.settings.canvas)}this.canvas=this.canvasElement.getContext("2d");var i=this.canvasElement.width,s=this.canvasElement.height;for(var e in Object.defineProperty(this,"width",{enumerable:!0,configurable:!0,set:function(t){i=isNaN(parseFloat(t))?i:parseFloat(t),this.canvasElement.width=i,this.background.set(this.settings.background),this.redraw()},get:function(){return i}}),Object.defineProperty(this,"height",{enumerable:!0,configurable:!0,set:function(t){s=isNaN(parseFloat(t))?s:parseFloat(t),this.canvasElement.height=s,this.background.set(this.settings.background),this.redraw()},get:function(){return s}}),y.modules){if(!0===this[e].wrapper)for(var r in this[e])"object"==typeof this[e][r]&&"function"==typeof this[e][r].setCore?this[e][r]=this[e][r].setCore(this):"function"==typeof this[e][r].setCore&&this[e][r].setCore(this),this[e].core=this;this[e].core=this}for(var n in y.inits)if("string"==typeof y.inits[n]&&"function"==typeof this[n][y.inits[n]])this[n][y.inits[n]]();else if("object"===y.inits[n])for(var a in y.inits[n])"function"==typeof this[n][y.inits[n][a]]&&this[n][y.inits[n][a]]();var o=this.settings.plugins;if(0<o.length)for(var h=0,c=o.length;h<c;h++)"function"==typeof y.plugins[o[h]]&&y.plugins[o[h]].call(this)},registerModule:function(t,e,i){if(~t.indexOf(".")){var s=t.split(".");y.modules[s[0]][s[1]]=e,i!==C&&(y.inits[s[0]]||(y.inits[s[0]]={}),y.inits[s[0]][s[1]]=i)}else y.modules[t]=e,i!==C&&(y.inits[t]=i)},registerPlugin:function(t,e){y.plugins[t]=e},create:function(t){return new y.core(t)},domReady:function(t){if(t=t||function(){},this.domReadyHandlers.push(t),this.isDomReadyListening)return!1;if(this.isDomReady)return y.triggerDomReadyHandlers(),!0;var e=function(t){("complete"===d.readyState||t&&"DOMContentLoaded"===t.type)&&(y.isDomReadyListening=!1,y.isDomReady=!0,y.triggerDomReadyHandlers(),d.removeEventListener("readystatechange",e,!1),d.removeEventListener("DOMContentLoaded",e,!1))};return!!e()||(this.isDomReadyListening?void 0:(y.isDomReadyListening=!0,d.addEventListener("readystatechange",e,!1),d.addEventListener("DOMContentLoaded",e,!1),!1))},isDomReady:!1,isDomReadyListening:!1,domReadyHandlers:[],triggerDomReadyHandlers:function(){var t,e,i,s;for(e=0,i=(t=this.domReadyHandlers).length;e<i;e++)(s=t[e])&&(delete t[e],s())}};y.core.prototype={addChild:function(t,e){return t.add(e),this},addChildAt:function(t,e,i){return t.addAt(e,i),this},removeChild:function(t,e){return t.remove(e),this},removeChildAt:function(t,e){return this.children[t]!==C&&this.children[t].remove(e),this},clear:function(t){return this.draw.clear(t),this},redraw:function(){return this.draw.redraw(),this},bind:function(t,e){return this.events.bind(this.canvasElement,t.split(" "),e),this},unbind:function(t,e){return this.events.unbind(this.canvasElement,t.split(" "),e),this},trigger:function(t,e){var i=this.events;return i.triggerHandlers(this.canvasElement,t.split(" "),i.fixEventObject(e)),this},reset:function(){for(var t=this.children,e=0,i=t.length;e<i;e++)t[e].remove(),e--,i--;t.length=0,this.lastObjectID=0;var s=this.canvasElement.events;for(var r in s)s[r]instanceof Array&&this.unbind(r,s[r]);this.settings=y.extend({},this.originalSettings)},destroy:function(){this.timeline&&this.timeline.stop(),this.reset();for(var t=0,e=this.domEventHandlers.length;t<e;t++)y.removeDOMEventHandler(this,t);this.domEventHandlers.length=0,y.canvasList[this.id]=null,this.canvasElement=d.createElement("canvas"),this.canvas=this.canvasElement.getContext("2d")}},(l.oCanvas=y).domReady(),y.extend=function(){var t=Array.prototype.slice.call(arguments),e=t[t.length-1],i=t.splice(0,1)[0],s=t.splice(0,1)[0],r,n=[],a;if(e.exclude&&JSON.stringify(e)===JSON.stringify({exclude:e.exclude})&&(n=e.exclude),s!==e||0===n.length)for(r in s)~n.indexOf(r)||((a=Object.getOwnPropertyDescriptor(s,r)).get||a.set?Object.defineProperty(i,r,a):i[r]=s[r]);return 0<t.length?y.extend.apply(this,[i].concat(t)):i},y.addDOMEventHandler=function(t,e,i,s,r){t.domEventHandlers.push({obj:e,event:i,handler:s,useCapture:!!r}),"touchend"!=i?e.addEventListener(i,s,r):$(e).on("vclick",s)},y.removeDOMEventHandler=function(t,e){var i=t.domEventHandlers[e];i.obj.removeEventListener(i.event,i.handler,i.useCapture)},y.isNumber=function(t){return!isNaN(parseFloat(t))&&isFinite(t)},"function"!=typeof Object.create&&(Object.create=function(t){function e(){}return e.prototype=t,new e}),"function"!=typeof Object.getPropertyDescriptor&&(Object.getPropertyDescriptor=function(t,e){for(var i=Object.getOwnPropertyDescriptor(t,e),s=Object.getPrototypeOf(t);i===C&&null!==s;)i=Object.getOwnPropertyDescriptor(s,e),s=Object.getPrototypeOf(s);return i}),function(){for(var n=0,t=["ms","moz","webkit","o"],e=0;e<t.length&&!l.requestAnimationFrame;++e)l.requestAnimationFrame=l[t[e]+"RequestAnimationFrame"],l.cancelAnimationFrame=l[t[e]+"CancelAnimationFrame"]||l[t[e]+"CancelRequestAnimationFrame"];l.requestAnimationFrame||(l.requestAnimationFrame=function(t,e){var i=(new Date).getTime(),s=Math.max(0,16-(i-n)),r=l.setTimeout(function(){t(i+s)},s);return n=i+s,r}),l.cancelAnimationFrame||(l.cancelAnimationFrame=function(t){clearTimeout(t)})}(),l.log=function(){if(log.history=log.history||[],log.history.push(arguments),this.console){var t,e=Array.prototype.slice.call(arguments),i=e.length;for(t=0;t<i;t++)console.log(e[t])}};var t=function(){var e={init:function(){var e=this;this.core.setLoop=function(t){return e.userLoop=t,e}},currentFrame:1,timeline:0,running:!1,set fps(t){this.core.settings.fps=t,this.running&&this.start()},get fps(){return this.core.settings.fps},loop:function(){this.running&&setTimeout(function(){e.timeline=requestAnimationFrame(e.loopBound);var t=e.core;"function"==typeof e.userLoop&&(!0===t.settings.clearEachFrame&&t.draw.clear(),e.userLoop.call(t,t.canvas),!0===t.settings.drawEachFrame&&t.draw.redraw(),e.currentFrame++)},1e3/e.fps)},loopBound:function(){e.loop()},start:function(){return cancelAnimationFrame(e.timeline),e.running=!0,e.loop(),this},stop:function(){return this.running=!1,cancelAnimationFrame(e.timeline),this}};return e};y.registerModule("timeline",t,"init");var e=function(){return{keysDown:{},keyPressTimers:{},modifiedKeys:[],init:function(){var e=this;y.addDOMEventHandler(this.core,d,"keydown",function(t){e.docHandler(t)},!1),y.addDOMEventHandler(this.core,d,"keyup",function(t){e.docHandler(t)},!1),y.addDOMEventHandler(this.core,d,"keypress",function(t){e.preventDefault(t)},!1)},docHandler:function(t){var e,i,s,r;if(i=this.core.events,s=this.core.canvasElement,i.enabled&&!(this.core.pointer&&!0!==this.core.pointer.canvasFocused||(e=this.getKeyCode(t),this.preventDefault(t),"keydown"===t.type&&!0===this.keysDown[e]||("keydown"===t.type?this.keysDown[e]=!0:"keyup"===t.type&&delete this.keysDown[e],r=i.fixEventObject(t,"keyboard"),i.lastKeyboardEventObject=r,i.triggerHandlers(s,[t.type]),"keydown"===t.type&&(this.keyPressTimers[e]=setInterval(function(){i.triggerHandlers(s,["keypress"],r)},1e3/this.core.settings.fps)),"keyup"!==t.type))))if(this.anyKeysDown())clearInterval(this.keyPressTimers[e]);else for(e in this.keyPressTimers)clearInterval(this.keyPressTimers[e])},preventDefault:function(t){if(this.core.mouse&&!0===this.core.mouse.canvasFocused||!this.core.mouse){var e=this.getKeyCode(t);~this.modifiedKeys.indexOf(e)&&t.preventDefault()}},addPreventDefaultFor:function(t){t="number"==typeof t?[t]:t instanceof Array?t:[];for(var e=0;e<t.length;e++)this.modifiedKeys.push(t[e])},removePreventDefaultFor:function(t){var e,i;for(t="number"==typeof t?[t]:t instanceof Array?t:[],e=0;e<t.length;e++)~(i=this.modifiedKeys.indexOf(t[e]))&&this.modifiedKeys.splice(i,1)},getKeyCode:function(t){return 0===t.keyCode?t.which:t.keyCode},numKeysDown:function(){var t,e,i;for(i in t=0,e=this.keysDown)!0===e[i]&&t++;return t},anyKeysDown:function(){return 0<this.numKeysDown()},getKeysDown:function(){var t,e,i;for(i in e=[],t=this.keysDown)!0===t[i]&&e.push(parseInt(i,10));return e},ARROW_UP:38,ARROW_DOWN:40,ARROW_LEFT:37,ARROW_RIGHT:39,SPACE:32,ENTER:13,ESC:27}};y.registerModule("keyboard",e,"init");var i=function(){return{x:0,y:0,buttonState:"up",canvasFocused:!1,canvasHovered:!1,cursorValue:"default",init:function(){this.core.events.addEventTypes("mouse",{move:"mousemove",enter:"mouseenter",leave:"mouseleave",down:"mousedown",up:"mouseup",singleClick:"click",doubleClick:"dblclick"}),this.types={mousemove:"move",mousedown:"down",mouseup:"up",dblclick:"doubleClick"},(this.core.pointer=this).core.touch&&this.core.touch.isTouch||this.bindHandlers()},bindHandlers:function(){var e,t,i,s;for(s in i=(t=(e=this).core).canvasElement,this.types){y.addDOMEventHandler(t,i,s,function(t){e.canvasHandler(t)},!1),"mousemove"===s&&(s="mouseover"),y.addDOMEventHandler(t,d,s,function(t){e.docHandler(t)},!1);var r=null;try{r=l.parent.document}catch(t){}r&&y.addDOMEventHandler(t,r,s,function(t){e.docHandler(t)},!1)}},canvasHandler:function(t,e){var i,s,r,n;if(i=this.core.events,s=this.onCanvas(t),"mouseup"===t.type&&!s&&!this.canvasUpEventTriggered)return i.triggerPointerEvent(this.types.mouseup,i.frontObject,"mouse",t),i.triggerPointerEvent(this.types.mouseup,this.core.canvasElement,"mouse",t),void(this.canvasUpEventTriggered=!0);(e||s)&&(r=e&&"mouseover"===t.type?"mousemove":t.type,e||(this.canvasHovered=!0),"mousedown"===r&&(this.canvasUpEventTriggered=!1,this.canvasFocused=!0,this.buttonState="down"),"mouseup"===r&&(this.buttonState="up"),n=e||!s?C:i.getFrontObject("mouse"),e&&i.frontObject?(i.triggerChain(i.getParentChain(i.frontObject,!0,!0),["mouseleave"]),i.frontObject=null):e?i.triggerHandlers(this.core.canvasElement,["mouseleave"]):i.triggerPointerEvent(this.types[r],n,"mouse",t))},docHandler:function(t){var e;this.onCanvas(t)||(this.core.canvasElement.events.hasEntered?"mouseover"===t.type&&this.canvasHandler(t,!0):("mouseup"===t.type&&"down"===this.buttonState&&this.canvasHandler(t,!0),"mousedown"===t.type&&(this.canvasFocused=!1)))},getPos:function(t){var e=this.core.canvasElement,i=e.getBoundingClientRect(),s=e.width/e.clientWidth,r=e.height/e.clientHeight,n=t.pageX-l.pageXOffset,a=t.pageY-l.pageYOffset,o,h;return{x:s*(n-Math.round(i.left)),y:r*(a-Math.round(i.top))}},updatePos:function(t){var e=this.getPos(t);this.x=e.x,this.y=e.y},onCanvas:function(t){var e=(t=t||this.core.events.lastPointerEventObject&&this.core.events.lastPointerEventObject.originalEvent)?this.getPos(t):{x:this.x,y:this.y};return 0<=e.x&&e.x<=this.core.width&&0<=e.y&&e.y<=this.core.height?(this.canvasHovered=!0,t&&this.updatePos(t),!0):this.canvasHovered=!1},cancel:function(){this.core.events.lastDownObject=null},hide:function(){this.core.canvasElement.style.cursor="none"},show:function(){this.core.canvasElement.style.cursor=this.cursorValue},cursor:function(t){if(~t.indexOf("url(")){var e=/url\((.*?)\)(\s(.*?)\s(.*?)|)($|,.*?$)/.exec(t),i=e[5]?e[5]:"";t="url("+e[1]+") "+(e[3]?e[3]:0)+" "+(e[4]?e[4]:0)+(""!==i?i:", default")}this.core.canvasElement.style.cursor=t,this.cursorValue=t}}};y.registerModule("mouse",i,"init");var s=function(){return{x:0,y:0,touchState:"up",canvasFocused:!1,canvasHovered:!1,isTouch:"ontouchstart"in l||"createTouch"in d,dblTapInterval:500,init:function(){var t,e;e=(t=this.core).canvasElement,t.events.addEventTypes("touch",{move:"touchmove",enter:"touchenter",leave:"touchleave",down:"touchstart",up:"touchend",singleClick:"tap",doubleClick:"dbltap"}),this.types={touchmove:"move",touchstart:"down",touchend:"up"},this.isTouch&&(t.pointer=this,e.style.WebkitUserSelect="none",e.style.WebkitTouchCallout="none",e.style.WebkitTapHighlightColor="rgba(0,0,0,0)"),this.bindHandlers()},bindHandlers:function(){var e,t,i,s;for(s in i=(t=(e=this).core).canvasElement,this.types){y.addDOMEventHandler(t,i,s,function(t){e.canvasHandler(t)},!1),y.addDOMEventHandler(t,d,s,function(t){e.docHandler(t)},!1);var r=null;try{r=l.parent.document}catch(t){}r&&y.addDOMEventHandler(t,r,s,function(t){e.docHandler(t)},!1)}this.core.settings.disableScrolling&&y.addDOMEventHandler(t,i,"touchmove",function(t){t.preventDefault()},!1)},canvasHandler:function(t,e){var i,s,r,n,a,o;if(i=this.core.events,s=this.onCanvas(t),"touchend"===t.type&&!s&&!this.canvasUpEventTriggered)return i.triggerPointerEvent(this.types.touchend,i.frontObject,"touch",t),i.triggerPointerEvent(this.types.touchend,this.core.canvasElement,"touch",t),void(this.canvasUpEventTriggered=!0);(e||s)&&(e||(this.canvasHovered=!0),"touchstart"===t.type&&(this.canvasUpEventTriggered=!1,this.canvasFocused=!0,this.touchState="down"),"touchend"===t.type&&(this.touchState="up"),r=e||!s?C:i.getFrontObject("touch"),e&&i.frontObject?(i.triggerChain(i.getParentChain(i.frontObject,!0,!0),["touchleave"]),i.frontObject=null):e?i.triggerHandlers(this.core.canvasElement,["touchleave"]):i.triggerPointerEvent(this.types[t.type],r,"touch",t),"touchstart"===t.type&&(n=(new Date).getTime(),!this.dblTapStart||n-this.dblTapStart.timestamp>this.dblTapInterval?this.dblTapStart={timestamp:n,obj:r,count:1}:this.dblTapStart.count++),"touchend"===t.type&&2===this.dblTapStart.count&&(n=(new Date).getTime(),a=r===this.dblTapStart.obj,o=n-this.dblTapStart.timestamp,a&&o<this.dblTapInterval&&i.triggerPointerEvent("doubleClick",r,"touch",t),delete this.dblTapStart))},docHandler:function(t){var e;this.onCanvas(t)||(this.core.canvasElement.events.hasEntered?"touchmove"===t.type&&this.canvasHandler(t,!0):("touchend"===t.type&&"down"===this.touchState&&this.canvasHandler(t,!0),"touchstart"===t.type&&(this.canvasFocused=!1)))},getPos:function(t){var e,i,s=t.changedTouches;if(s!==C&&0<s.length){t=s[0];var r=this.core.canvasElement,n=r.getBoundingClientRect(),a=r.width/r.clientWidth,o=r.height/r.clientHeight,h=t.pageX-l.pageXOffset,c=t.pageY-l.pageYOffset;e=a*(h-Math.round(n.left)),i=o*(c-Math.round(n.top))}else e=this.x,i=this.y;return{x:e,y:i}},updatePos:function(t){var e=this.getPos(t);this.x=e.x,this.y=e.y},onCanvas:function(t){var e=(t=t||this.core.events.lastPointerEventObject&&this.core.events.lastPointerEventObject.originalEvent)?this.getPos(t):{x:this.x,y:this.y};return 0<=e.x&&e.x<=this.core.width&&0<=e.y&&e.y<=this.core.height?(this.canvasHovered=!0,t&&this.updatePos(t),!0):this.canvasHovered=!1},cancel:function(){this.core.events.lastDownObject=null}}};y.registerModule("touch",s,"init");var r=function(){return{transformPointerPosition:function(t,e,i,s,r){if(s=s||0,r=r||this.core.pointer,"object"==typeof t){var n=t.parent,a=[],o={x:0,y:0},h,c,l,d,u;for(a.push(t);n&&n!==this.core;)a.push(n),n=n.parent;for(a.reverse(),h=r,l=0,d=a.length;l<d;l++)c=a[l],h=o=this.transformPointerPosition(c.rotation,c.abs_x,c.abs_y,0,h);return 0!==s&&(u=t.getOrigin(),o=this.transformPointerPosition(-1*s,e-u.x,i-u.y,0,h)),{x:o.x,y:o.y}}var f=t,g=r.x>=e&&r.y<=i,p=r.x>=e&&r.y>=i,y=r.x<=e&&r.y>=i,b=r.x<=e&&r.y<=i,_=Math.sqrt(Math.pow(r.x-e,2)+Math.pow(r.y-i,2)),f=360*(f/360-Math.floor(f/360))-s,v,m,x,w=0===_?0:Math.abs(r.y-i)/_;return g||y?(v=(180-f-180*Math.asin(w)/Math.PI)*Math.PI/180,m=e+Math.cos(v)*_*(g?-1:1),x=i+Math.sin(v)*_*(g?-1:1)):(b||p)&&(v=(180*Math.asin(w)/Math.PI-f)*Math.PI/180,m=e+Math.cos(v)*_*(b?-1:1),x=i+Math.sin(v)*_*(b?-1:1)),{x:m,y:x}},isPointerInside:function(t,e){var i=t.getOrigin();if("line"===t.type){var s=Math.abs(t._.end_x-t.abs_x),r=Math.abs(t._.end_y-t.abs_y),n=Math.sqrt(s*s+r*r),a=t.start,o=t.end,h=a.x<o.x&&a.y<o.y||a.x>o.x&&a.y>o.y?-1:1,c=Math.asin(r/n)*(180/Math.PI)*h,l;return(l=this.transformPointerPosition(t,t.abs_x,t.abs_y,c,e)).x>t.abs_x-n-i.x&&l.x<t.abs_x+n-i.x&&l.y>t.abs_y-t.strokeWidth/2-i.y&&l.y<t.abs_y+t.strokeWidth/2-i.y}if("text"===t.type){var l=this.transformPointerPosition(t,t.abs_x,t.abs_y,0,e),d=t.strokeWidth/2,u=t._.lines,f=u.length,g=t.size*t.lineHeight,p=t.align,y="rtl"===this.core.canvasElement.dir,b,_,v,m,x,w,O,M;for(b={top:.05*t.size,hanging:-.12*t.size,middle:-.47*t.size,alphabetic:-.78*t.size,ideographic:-.83*t.size,bottom:-1*t.size},_=0;_<f;_++)if(v={start:y?t.width-u[_].width:0,left:0,center:(t.width-u[_].width)/2,end:y?0:t.width-u[_].width,right:t.width-u[_].width},x=(m=t.abs_x+v[p])+u[_].width,O=(w=t.abs_y+g*_+b[t.baseline])+g+(0<f&&_<f-1?1:0),M=l.x>m-i.x-d&&l.x<x-i.x+d&&l.y>w-i.y-d&&l.y<O-i.y+d)return!0;return!1}if("rectangular"===t.shapeType){var l=this.transformPointerPosition(t,t.abs_x,t.abs_y,0,e),d="outside"===t.strokePosition?t.strokeWidth:"center"===t.strokePosition?t.strokeWidth/2:0;return l.x>t.abs_x-i.x-d&&l.x<t.abs_x+t.width-i.x+d&&l.y>t.abs_y-i.y-d&&l.y<t.abs_y+t.height-i.y+d}if("ellipse"===t.type&&t.radius_x===t.radius_y){var l=this.transformPointerPosition(t,t.abs_x,t.abs_y,0,e),n;return(n=Math.sqrt(Math.pow(l.x-t.abs_x+i.x,2)+Math.pow(l.y-t.abs_y+i.y,2)))<t.radius_x+t.strokeWidth/2}if("ellipse"===t.type){var l=this.transformPointerPosition(t,t.abs_x,t.abs_y,0,e),k=t.radius_x+t.strokeWidth/2,P=t.radius_y+t.strokeWidth/2;return l.x-=t.abs_x-i.x,l.y-=t.abs_y-i.y,l.x*l.x/(k*k)+l.y*l.y/(P*P)<1}if("polygon"===t.type){var l=this.transformPointerPosition(t,t.abs_x,t.abs_y,0,e),C=t.radius+t.strokeWidth/2,j=t.sides,T=j-1,E=!1,_,R,F;for(_=0;_<j;_++)R={x:t.abs_x-i.x+C*Math.cos(2*_*Math.PI/j),y:t.abs_y-i.y+C*Math.sin(2*_*Math.PI/j)},F={x:t.abs_x-i.x+C*Math.cos(2*T*Math.PI/j),y:t.abs_y-i.y+C*Math.sin(2*T*Math.PI/j)},(R.y<l.y&&F.y>=l.y||F.y<l.y&&R.y>=l.y)&&R.x+(l.y-R.y)/(F.y-R.y)*(F.x-R.x)<l.x&&(E=!E),T=_;return E}if("arc"===t.type){var D=t.end-t.start,H="clockwise"===t.direction?(D<0?360:0)+(D%360?D%360:0<D?360:0):Math.abs(D),W="clockwise"===t.direction?-1*t.start:-1*t.end,l=this.transformPointerPosition(t,t.abs_x,t.abs_y,W,e),n=Math.sqrt(Math.pow(l.x-t.abs_x+i.x,2)+Math.pow(l.y-t.abs_y+i.y,2)),C=t.radius,N={},I={},k,L,S,c;if(0===t.strokeWidth&&C<n||0<t.strokeWidth&&n>C+t.strokeWidth/2)return!1;if(C===t.strokeWidth/2||t.pieSection){var A=t.pieSection?t.radius:A,z,q,B,X,Y,z,q,B,X;if(180<H)return z=Math.abs(t.abs_x-i.x-l.x),q=Math.abs(t.abs_y-i.y-l.y),B=Math.sqrt(z*z+q*q),X=180*Math.acos(z/B)/Math.PI,l.y>=t.abs_y-i.y&&n<=A||l.y<t.abs_y-i.y&&l.x<t.abs_x-i.x&&X<=H-180;if(180===H)return l.y>=t.abs_y-i.y&&n<=A;if(H<180)return W=90-H/2-("clockwise"===t.direction?t.start:t.end),l=this.transformPointerPosition(t,t.abs_x,t.abs_y,W,e),C*=2,Y=Math.cos(H/2*Math.PI/180)*C,z=Math.abs(t.abs_x-i.x-l.x),q=Math.abs(t.abs_y-i.y-l.y),B=Math.sqrt(z*z+q*q),X=180*Math.asin(z/B)/Math.PI,l.y>=t.abs_y-i.y+Y||l.y>=t.abs_y-i.y&&X<=H/2}else{if(180<H){k=(360-H)/2,L=Math.cos(k*Math.PI/180)*C,N.x=t.abs_x-i.x+Math.cos(k*Math.PI/180)*L,N.y=t.abs_y-i.y-Math.sin(k*Math.PI/180)*L,S=180-2*k,I.x=t.abs_x-i.x-Math.cos(S*Math.PI/180)*C,I.y=t.abs_y-i.y-Math.sin(S*Math.PI/180)*C;var V=90-(90-S)-(90-k);if(l.y<N.y&&l.x<N.x)c=k-180*Math.acos(Math.abs(l.y-N.y)/Math.sqrt(Math.pow(l.x-N.x,2)+Math.pow(l.y-N.y,2)))/Math.PI;else if(l.y>N.y&&l.x>=N.x)c=V-180*Math.acos(Math.abs(l.x-N.x)/Math.sqrt(Math.pow(l.x-N.x,2)+Math.pow(l.y-N.y,2)))/Math.PI;else{if(l.y<t.abs_y-i.y&&l.x>=N.x)return!1;c=-1e6}return!((""===t.fill||"transparent"===t.fill)&&0<t.strokeWidth&&n<C-t.strokeWidth/2)&&(c<=0&&l.x>=I.x&&l.y>N.y&&l.y<t.abs_y-i.y||(c<=0&&l.y<=t.abs_y-i.y&&n<=C||(0===t.strokeWidth&&n<=C||0<t.strokeWidth&&n<=C+t.strokeWidth/2)&&(l.x<=I.x&&l.y<=t.abs_y-i.y||l.y>=t.abs_y-i.y)))}if(180===H)return l.y>=t.abs_y-i.y&&(0===t.strokeWidth&&n<=C||0<t.strokeWidth&&n<=C+t.strokeWidth/2);var K,Y;if(H<180)return W=90-H/2-("clockwise"===t.direction?t.start:t.end),l=this.transformPointerPosition(t,t.abs_x,t.abs_y,W,e),K=""===t.fill?C-t.strokeWidth/2:C,Y=Math.cos(H/2*Math.PI/180)*K,""===t.fill&&0<t.strokeWidth?l.y>=t.abs_y-i.y+Y&&n>=C-t.strokeWidth/2&&n<=C+t.strokeWidth/2:l.y>=t.abs_y-i.y+Y&&(!(0<t.strokeWidth)||n<=C+t.strokeWidth/2)}}else if("radial"===t.shapeType){var C;if(0<(C=t.radius?t.radius:0)){var l=this.transformPointerPosition(t,t.abs_x,t.abs_y,0,e),i=t.getOrigin(),n;return(n=Math.sqrt(Math.pow(l.x-t.abs_x+i.x,2)+Math.pow(l.y-t.abs_y+i.y,2)))<C}}}}};y.registerModule("tools",r);var n=function(){return{enabled:!0,eventTypes:{},init:function(){this.core.canvasElement.events={}},addEventTypes:function(t,e){this.eventTypes[t]=this.eventTypes[t]||[];var i=this.eventTypes[t];for(var s in e)i[s]=i[s]||[],i[s].push(e[s])},bind:function(t,e,i){for(var s=0;s<e.length;s++)t.events[e[s]]=t.events[e[s]]||[],t.events[e[s]].push(i)},unbind:function(t,e,i){var s,r,n;for(s=0;s<e.length;s++)(r=t.events[e[s]])!==C&&(i===C?delete t.events[e[s]]:~(n=r.indexOf(i))&&r.splice(n,1))},findFrontObject:function(t,e){var i,s,r;if(0===t.length)return!1;for(i=t.length;i--&&(s=t[i],!1===(r=this.findFrontObject(s.children,e)));)if(s.pointerEvents&&s.isPointerInside(e)){r=s;break}return r},getFrontObject:function(t){return this.findFrontObject(this.core.children,this.core[t])||C},triggerPointerEvent:function(t,e,i,s){if(this.enabled){var r,n,a,o,h,c,l,d,u,f,g;if(r=this.core.canvasElement,a=(n=this.eventTypes[i]).enter,o=n.leave,h=n[t],c=n.singleClick,this.lastPointerEventObject=this.fixEventObject(s,i),e){if(e!==this.frontObject){if(this.frontObject&&!~(l=this.getParentChain(e)).indexOf(this.frontObject))if(this.triggerHandlers(this.frontObject,o),~(l=this.getParentChain(this.frontObject)).indexOf(e)){for(d=[],f=0,g=l.length;f<g&&l[f]!==e;f++)d.push(l[f]);this.triggerChain(d,o)}else this.triggerChain(l,o);((this.frontObject=e).parent||r).events.hasEntered||(l=this.findNonEnteredParentChain(e),this.triggerChain(l,a)),e.events.hasEntered||this.triggerHandlers(e,a)}}else this.frontObject?(d=this.getParentChain(this.frontObject,!1,!0),this.triggerChain(d,o),this.frontObject=null):r.events.hasEntered||this.triggerHandlers(r,a),e=this.core.canvasElement;"down"===t&&(this.lastDownObject=e),d=this.getParentChain(e,!0,!0),this.triggerChain(d,h),"up"===t&&(e===this.lastDownObject?this.triggerChain(d,c):(u=this.getSharedParent(e,this.lastDownObject))&&(d=this.getParentChain(u,!0,!0),this.triggerChain(d,c)),this.lastDownObject=null)}},getSharedParent:function(t,e){var i,s,r;for(i=this.getParentChain(t,!0,!0),s=this.core.canvasElement,r=e;r&&!~i.indexOf(r);)r=r.parent||(r!==s?s:C);return r},findNonEnteredParentChain:function(t){var e,i,s;for(e=[],i=this.core.canvasElement,s=t.parent;s&&!s.events.hasEntered;)e.push(s),s=s.parent;return s||i.events.hasEntered||e.push(i),e.reverse()},getParentChain:function(t,e,i){var s,r;for(s=[],i&&s.push(t),r=t.parent;r;)s.push(r),r=r.parent;return e&&t!==this.core.canvasElement&&s.push(this.core.canvasElement),s},triggerChain:function(t,e,i){var s,r,n;for(s=0,r=t.length;s<r&&(n=this.triggerHandlers(t[s],e,i));s++);},triggerHandlers:function(t,e,i){var s,r,n,a,o,h,c,l=t===this.core.canvasElement?this.core:t;for(s=0;s<e.length;s++)if(r=t.events[e[s]],n=!!~e[s].indexOf("enter"),a=!!~e[s].indexOf("leave"),(c=i||(~e[s].indexOf("key")?this.lastKeyboardEventObject:this.lastPointerEventObject)).type=e[s],c.bubbles=!n&&!a,n&&!t.events.hasEntered?t.events.hasEntered=!0:a&&t.events.hasEntered&&(t.events.hasEntered=!1),r){for(o=r.length,h=0;h<o;h++)"function"==typeof r[h]&&r[h].call(l,c);if(c.stoppingPropagation)return c.stoppingPropagation=!1}return!0},fixEventObject:function(t,e){var i="altKey ctrlKey metaKey shiftKey button charCode keyCode clientX clientY pageX pageY screenX screenY detail eventPhase isChar touches targetTouches changedTouches scale rotation".split(" "),s=i.length,r,n,a,o;if(r={originalEvent:t,timeStamp:(new Date).getTime(),which:t===C?0:0===t.which?t.keyCode:t.which,preventDefault:function(){t!==C&&t.preventDefault()},stopPropagation:function(){this.bubbles&&(this.stoppingPropagation=!0),t!==C&&t.stopPropagation()}},t===C)return r;for(n=0;n<s;n++)a=i[n],t[a]!==C&&(r[a]=t[a]);return~"mouse touch".indexOf(e)&&(r.x=this.core[e].x,r.y=this.core[e].y),"mouse"===e&&(o={0:1,2:2,1:3,default:0},r.which=o[r.button]||o.default),"touch"===e&&(r.which=0),r}}};y.registerModule("events",n,"init");var a=function(){return{objects:[],translation:{x:0,y:0},changeZorder:function(t,e,i){var s=t.children,r=s[e],n=s[i],a,o,h,c;r!==C&&e!==i&&(i>s.length-1&&(i=s.length-1),i<0&&(i=0),e<i?(a=s.slice(0,e),h=s.slice(i+1,s.length),(o=s.slice(e,i+1)).shift(),o.push(r)):(a=s.slice(0,i),h=s.slice(e+1,s.length),(o=s.slice(i,e+1)).pop(),o.unshift(r)),t.children=a.concat(o).concat(h))},clear:function(t){return this.core.canvas.clearRect(0,0,this.core.width,this.core.height),!1!==t&&this.core.background.redraw(),this.isCleared=!0,this},redraw:function(t){return t=t||!1,(this.core.settings.clearEachFrame||t)&&this.clear(),this.isCleared=!1,this.drawObjects(this.core.children),this},drawObjects:function(t){var e=this.core.canvas,i,s,r,n,a,o,h,c,l,d,u,f,g,p;for(i=0,s=t.length;i<s;i++)if((r=t[i])!==C&&"function"==typeof r.draw){e.strokeStyle="#000",e.fillStyle="#000",e.globalAlpha=1,e.lineWidth=1,e.lineCap="butt",e.lineJoin="miter",e.miterLimit=10,e.lineDashOffset=0,e.shadowOffsetX=0,e.shadowOffsetY=0,e.shadowBlur=0,e.shadowColor="rgba(0, 0, 0, 0)",e.globalCompositeOperation="source-over",e.font="10px sans-serif",e.textAlign="start",e.textBaseline="alphabetic",e.direction="inherit",e.imageSmoothingEnabled=!0,"function"==typeof r.update&&r.update(),e.save(),e.translate(r.x,r.y),0!==r.rotation&&e.rotate(r.rotation*Math.PI/180),1===r.scalingX&&1===r.scalingY||e.scale(r.scalingX,r.scalingY),p=r.opacity;for(var f=r.parent;f&&f!==this.core;)p*=f.opacity,f=f.parent;this.translation={x:r.abs_x,y:r.abs_y},a=r.abs_x,o=r.abs_y,r._.abs_x=0,r._.abs_y=0,e.globalAlpha=isNaN(parseFloat(p))?1:parseFloat(p),e.globalCompositeOperation=r.composition,0<(g=r.shadow).blur&&(e.shadowOffsetX=g.offsetX,e.shadowOffsetY=g.offsetY,e.shadowBlur=g.blur,e.shadowColor=g.color),e.lineCap=r.cap,e.lineJoin=r.join,e.miterLimit=r.miterLimit,r.draw(),r.drawn=!0,r._.abs_x=a,r._.abs_y=o,0<r.children.length&&this.drawObjects(r.children),e.restore(),this.translation={x:0,y:0}}}}};y.registerModule("draw",a);var o=function(){return{bg:"",value:"",type:"transparent",loaded:!1,init:function(){this.set(this.core.settings.background)},set:function(t){var e=this;if("string"!=typeof t&&(t=""),~(this.value=t).indexOf("gradient")?this.type="gradient":~t.indexOf("image")?this.type="image":this.core.style&&this.core.style.isColor(t)?this.type="color":this.type="transparent","color"===this.type)this.bg=t,this.core.timeline&&!this.core.timeline.running&&this.core.draw.redraw(!0),this.loaded=!0;else if("gradient"===this.type)this.bg=this.core.style?this.core.style.getGradient(t,0,0,this.core.width,this.core.height):"",this.core.timeline&&!this.core.timeline.running&&this.core.draw.redraw(!0),this.loaded=!0;else if("image"===this.type){var i=/image\((.*?)(,(\s|)(repeat|repeat-x|repeat-y|no-repeat)|)\)/.exec(t),s=i[1],r=i[4]||"repeat",n=new Image;n.src=s,n.onload=function(){e.bg=e.core.canvas.createPattern(this,r),e.loaded=!0,e.core.timeline&&!e.core.timeline.running&&e.core.redraw(!0)}}else this.redraw(!0),this.loaded=!0;return this},redraw:function(){var t=this.core;"transparent"!==this.type&&(t.canvas.fillStyle=this.bg,t.canvas.fillRect(0,0,t.width,t.height))}}};y.registerModule("background",o,"init");var h=function(){return{current:"none",scenes:{},create:function(t,e){return this.scenes[t]=Object.create(this.scenesBase()),this.scenes[t].name=t,e.call(this.scenes[t]),this.scenes[t]},scenesBase:function(){return{name:"",objects:[],loaded:!1,add:function(t){return this.objects.push(t),this.loaded&&t.add(),this},remove:function(t){var e=this.objects.indexOf(t);return~e&&(this.objects.splice(e,1),this.loaded&&t.remove()),this},load:function(){if(!this.loaded){var t=this.objects,e,i=t.length;for(e=0;e<i;e++)t[e]!==C&&t[e].add(!1);return this.loaded=!0,this}},unload:function(){var t=this.objects,e,i=t.length;for(e=0;e<i;e++)t[e]!==C&&t[e].remove(!1);return this.loaded=!1,this}}},load:function(t,e){return!0===e&&"none"!==this.current&&this.unload(this.current),this.current=t,this.scenes[t].load(),this.core.draw.redraw(),this},unload:function(t){return this.current="none",this.scenes[t].unload(),this.core.draw.redraw(),this}}};y.registerModule("scenes",h);var c=function(){return{getStroke:function(t,e){if(e="string"===e?"string":"object","object"==typeof t&&"string"===e){var i=t;t="string"==typeof i.pos?i.pos:"center",t+=" "+("number"==typeof i.width?i.width+"px":"1px"),t+=" "+("string"==typeof i.color?i.color:"#000000")}for(var s=t.split(" "),r,n,a=0,o=s.length;a<o;a++)!r&&-1<s[a].indexOf("(")&&(r=a),-1<s[a].indexOf(")")&&(n=a);var h;(h=n?s.splice(r,n-r+1):C)&&s.push(h.join(" "));var c=["outside","center","inside"],l="",a,d=s.length,u,f,h,g;if(3<=d)if(~c.indexOf(s[0])){if(3<d){for(a=2;a<d;a++)l+=s[a]+(a===d-1?" ":"");s=[s[0],s[1],l]}s={pos:s[0],width:parseFloat(s[1]),color:s[2]}}else{for(a=(g=isNaN(parseInt(s[0])))?0:1;a<d;a++)l+=s[a]+(a===d-1?" ":"");s=g?[1,l]:[s[0],l],d=2}return 2===d&&(s={pos:"center",width:parseFloat(s[0]),color:s[1]}),s.length&&(s={pos:"center",width:0,color:""}),"string"===e?s.pos+" "+s.width+"px "+s.color:"object"===e?s:void 0},getGradient:function(t,e,i,s,r){return~t.indexOf("linear")?this.getLinearGradient(t,e,i,s,r):~t.indexOf("radial")?this.getRadialGradient(t,e,i,s,r):"transparent"},getLinearGradient:function(t,e,i,s,r){var n,a,o,h=[],c,l,d,u,f,g,p=["top","bottom","left","right"],y,b,_=[],v,m;for(a=/\((.*)\)/.exec(t)[1];y=/((hsl|hsla|rgb|rgba)\(.*?\))/.exec(a);)b=_.push(y[1])-1,a=a.substring(0,y.index)+"###"+b+"###"+a.substring(y.index+y[1].length,a.length);if(o=(a=a.split(","))[0].split(" "),(~p.indexOf(o[0])||~o[0].indexOf("deg"))&&h.push(o[0]),1<o.length&&~p.indexOf(o[1])&&h.push(o[1]),0===h.length?h.push("top"):l=1,1===h.length){if("top"===h[0])f=d=e+s/2,g=(u=i)+r;else if("right"===h[0])d=e+s,f=e,g=u=i+r/2;else if("bottom"===h[0])u=i+r,f=d=e+s/2,g=i;else if("left"===h[0])f=(d=e)+s,g=u=i+r/2;else if(~h[0].indexOf("deg")){var x,w,O,M,k,P,C,j,T=Math.PI,E=e+s/2,R=i+r/2;0<=(w=x=parseFloat(h)%360*T/180)&&x<T/2?(P=e+s,C=i):T/2<=x&&x<T?(j=R,R=E,C=e,P=j,E=i):T<=x&&x<1.5*T?(j=R,P=E,E=e,R=i+r,C=j):1.5*T<=x&&x<2*T&&(j=R,R=e+s,C=E,P=i+r,E=j),x%=T/2,O=Math.atan(Math.abs(R-C)/Math.abs(P-E)),k=(M=Math.sqrt(Math.pow(R-C,2)+Math.pow(E-P,2)))*Math.cos(O-x),0<=w&&w<T/2?(d=2*E-(f=E+k*Math.cos(x)),u=2*R-(g=R-k*Math.sin(x))):T/2<=w&&w<T?(d=2*R-(f=R-k*Math.cos(T/2-x)),u=2*P-(g=P-k*Math.sin(T/2-x))):T<=w&&w<1.5*T?(d=2*P-(f=P+k*Math.cos(T-x)),u=2*C-(g=C+k*Math.sin(T-x))):1.5*T<=w&&w<2*T&&(d=2*C-(f=C-k*Math.cos(1.5*T-x)),u=2*E-(g=E-k*Math.sin(1.5*T-x)))}}else~h.indexOf("top")&&~h.indexOf("left")?(f=(d=e)+s,g=(u=i)+r):~h.indexOf("top")&&~h.indexOf("right")?(d=e+s,f=e,g=(u=i)+r):~h.indexOf("bottom")&&~h.indexOf("left")?(u=i+r,f=(d=e)+s,g=i):~h.indexOf("bottom")&&~h.indexOf("right")&&(d=e+s,u=i+r,f=e,g=i);for(n=this.core.canvas.createLinearGradient(d,u,f,g),v=this.getColorStops(n,a.slice(l),_),m=0;m<v.length;m++)n.addColorStop(v[m].pos/100,v[m].color);return n},getRadialGradient:function(t,e,i,s,r){var n,a=["left","center","right"],o=["top","center","bottom"],h={left:e,center:e+s/2,right:e+s},c={top:i,center:i+r/2,bottom:i+r},l=["closest-side","closest-corner","farthest-side","farthest-corner","contain","cover"],d,u,f,g,p,y=[],b,_,v,m=0,x=[{x:C,y:C,r:0},{x:C,y:C,r:C}],w,O,M,k,P=!1;for(d=/\((.*)\)/.exec(t)[1];g=/((hsl|hsla|rgb|rgba)\(.*?\))/.exec(d);)p=y.push(g[1])-1,d=d.substring(0,g.index)+"###"+p+"###"+d.substring(g.index+g[1].length,d.length);for(f=(d=d.split(/\s*,\s*/)).length,u=0;u<2;u++)~d[u].indexOf(" ")?("center"===(v=d[u].split(" "))[0]?(x[u].x=v[0],x[u].y=v[1],m=u+1
):~a.indexOf(v[0])?(x[u].x=v[0],m=u+1,~o.indexOf(v[1])&&(x[u].y=v[1])):~o.indexOf(v[0])?(x[u].y=v[0],m=u+1,~a.indexOf(v[1])&&(x[u].x=v[1])):isNaN(parseFloat(v[0]))||(x[u].x=v[0],m=u+1,!~o.indexOf(v[1])&&isNaN(parseFloat(v[1]))||(x[u].y=v[1])),x[u].x||(x[u].x="center"),x[u].y||(x[u].y="center")):(~a.indexOf(d[u])?(x[u].x=d[u],m=u+1):~o.indexOf(d[u])?(x[u].y=d[u],m=u+1):x[u].x=1===u?x[0].x:"center",x[u].y=1===u?x[0].y:"center");for(~l.indexOf(d[m])&&(k=d[m],P=!0),/\d+(%|px)\s/.test(d[m])&&(k=parseFloat(d[m]),P=!0,isNaN(k)&&(k=0)),k===C&&(k="cover"),u=0;u<2;u++)for(x[u].abs_x=h[x[u].x],x[u].abs_y=c[x[u].y],w=0;w<2;w++)O="abs_"+(0===w?"x":"y"),x[u][O]===C&&(x[u][O]=parseFloat(x[u]["abs_x"===O?"x":"y"]),isNaN(x[u][O])&&(x[u][O]="abs_x"===O?h.center-e:c.center-i),~x[u]["abs_x"===O?"x":"y"].indexOf("%")&&(x[u][O]=x[u][O]/100*("abs_x"===O?s:r)),x[u][O]+="abs_x"===O?e:i);for(~l.indexOf(k)&&(k="closest-side"===k||"contain"===k?Math.min(Math.abs(x[1].abs_y-i),Math.abs(i+r-x[1].abs_y),Math.abs(x[1].abs_x-e),Math.abs(e+s-x[1].abs_y)):"closest-corner"===k?Math.min(Math.sqrt(Math.pow(x[1].abs_x-e,2)+Math.pow(x[1].abs_y-i,2)),Math.sqrt(Math.pow(e+s-x[1].abs_x,2)+Math.pow(x[1].abs_y-i,2)),Math.sqrt(Math.pow(e+s-x[1].abs_x,2)+Math.pow(i+r-x[1].abs_y,2)),Math.sqrt(Math.pow(x[1].abs_x-e,2)+Math.pow(i+r-x[1].abs_y,2))):"farthest-corner"===k||"cover"===k?Math.max(Math.sqrt(Math.pow(x[1].abs_x-e,2)+Math.pow(x[1].abs_y-i,2)),Math.sqrt(Math.pow(e+s-x[1].abs_x,2)+Math.pow(x[1].abs_y-i,2)),Math.sqrt(Math.pow(e+s-x[1].abs_x,2)+Math.pow(i+r-x[1].abs_y,2)),Math.sqrt(Math.pow(x[1].abs_x-e,2)+Math.pow(i+r-x[1].abs_y,2))):"farthest-side"===k?Math.max(Math.abs(x[1].abs_y-i),Math.abs(i+r-x[1].abs_y),Math.abs(x[1].abs_x-e),Math.abs(e+s-x[1].abs_y)):0),~d[m].indexOf("%")&&(k=k/100*(M=~d[m].indexOf(" ")&&"height"===d[m].split(" ")[1]?r:s)),x[1].r=k,n=this.core.canvas.createRadialGradient(x[0].abs_x,x[0].abs_y,x[0].r,x[1].abs_x,x[1].abs_y,x[1].r),b=this.getColorStops(n,d.slice(m+(P?1:0)),y),_=0;_<b.length;_++)n.addColorStop(b[_].pos/100,b[_].color);return n},getColorStops:function(t,e,i){var s,r=e.length,n,a,o,h,c=[];for(s=0;s<r&&(n=e[s].trim(),!(100<=h));s++)~n.indexOf(" ")?(o=(a=n.split(" "))[0],h=~(h=a[1]).indexOf("px")?parseFloat(h)/Math.sqrt(Math.pow(eX-sX,2)+Math.pow(eY-sY,2))*100:parseFloat(h)):(o=n,h===C?h=0:(h=h||0,h+=(100-h)/(r-s))),~o.indexOf("###")&&(o=i[/###(\d+)###/.exec(o)[1]]),c.push({pos:h,color:o});return c},getFont:function(t,e){if(e="string"===e?"string":"object","object"==typeof t&&"string"===e){var i=t;t="string"==typeof i.style?i.style:"normal",t+=" "+("string"==typeof i.variant?i.variant:"normal"),t+=" "+("string"==typeof i.weight?i.weight:"normal"),t+=" "+("number"==typeof i.size?~~(10*i.size+.5)/10+"px":"16px"),t+="/"+("number"==typeof i.lineHeight?~~(10*i.lineHeight+.5)/10:"string"==typeof i.lineHeight&&-1<i.lineHeight.indexOf("px")?i.lineHeight:1),t+=" "+("string"==typeof i.family?i.family:"sans-serif")}if(0<t.length){var s=t.split(" "),r=s.length,n,t,a,o,h="",c=["normal","italic","oblique"],l=["normal","small-caps"],d=["normal","bold","bolder","lighter","100","200","300","400","500","600","700","800","900"],u={};for(n=0;n<r;n++)if(t=s[n],~c.indexOf(t)&&!u.style)u.style=t;else if(~l.indexOf(t)&&!u.variant)u.variant=t;else if(~d.indexOf(t)&&!u.weight)u.weight=t;else if(!~t.indexOf("/")||u.size||u.lineHeight){if(!u.size&&/\d+[a-z]{2}(?!\/)/.test(t))isNaN(parseInt(t))||(u.size=parseInt(t));else if(isNaN(parseInt(t))&&!u.family){for(h="",o=n;o<r;o++)h+=s[o]+(o===r-1?"":" ");u.family=h}}else a=t.split("/"),isNaN(parseInt(a[0]))||(u.size=parseInt(a[0])),isNaN(parseFloat(a[1]))||(u.lineHeight=parseFloat(a[1]),u.lineHeightUnit=-1<a[1].indexOf("px")?"px":"relative")}return(s=u||{}).style=s.style?s.style:"normal",s.variant=s.variant?s.variant:"normal",s.weight=s.weight?s.weight:"normal",s.size=s.size!==C?s.size:16,s.lineHeight=s.lineHeight!==C?s.lineHeight:1,s.lineHeightUnit=s.lineHeightUnit!==C?s.lineHeightUnit:"relative",s.family=s.family?s.family:"sans-serif","string"===e?s.style+" "+s.variant+" "+s.weight+" "+s.size+"px/"+s.lineHeight+("px"===s.lineHeightUnit?"px":"")+" "+s.family:"object"===e?s:void 0},getShadow:function(t,e){var i={},s;if("object"==typeof t)i.offsetX=isNaN(parseFloat(t.offsetX))?0:parseFloat(t.offsetX),i.offsetY=isNaN(parseFloat(t.offsetY))?0:parseFloat(t.offsetY),i.blur=isNaN(parseFloat(t.blur))?0:parseFloat(t.blur),i.color=this.isColor(t.color)?t.color:"#000";else if("string"==typeof t){var s=/^(.*?)\s(.*?)\s(.*?)\s(.*?)$/.exec(t);i.offsetX=isNaN(parseFloat(s[1]))?0:parseFloat(s[1]),i.offsetY=isNaN(parseFloat(s[2]))?0:parseFloat(s[2]),i.blur=isNaN(parseFloat(s[3]))?0:parseFloat(s[3]),i.color=this.isColor(s[4])?s[4]:"#000"}return"string"===e?i.offsetX+"px "+i.offsetY+"px "+i.blur+"px "+i.color:i},isColor:function(t){return"string"==typeof t&&("#"===t[0]||"rgb("===t.substr(0,4)||"rgba("===t.substr(0,5)||"hsl("===t.substr(0,4)||"hsla("===t.substr(0,5))}}};y.registerModule("style",c),l.logs=[];var u=function(){var n={durations:{short:500,normal:1e3,long:2e3},defaults:{duration:"normal",easing:"ease-in-out"},animate:function(t,e){var i=this.parseArguments(e),s=i.properties,r=i.options,n=this.queues.create(t,r.queue),a={obj:t,properties:s,startValues:{},diffValues:{},options:{queue:n,duration:r.duration,easing:r.easing,callback:r.callback}};n.add(a),n.run()},parseArguments:function(t){var e,i;return(t=Array.prototype.slice.call(t))[1]=t[1]||{},"object"==typeof t[1]?(i=t[0],(e=y.extend({duration:this.defaults.duration,easing:this.defaults.easing,queue:"default",callback:function(){}},t[1])).easing=this.parseEasingOption(e.easing),e.duration=this.parseDurationOption(e.duration)):(i=t.shift(),e=this.getAnimateArguments(t)),{properties:i,options:e}},parseEasingOption:function(t){return"string"==typeof t?~t.indexOf("cubic-bezier")?this.getCustomCubicBezier(t)||this.easing[this.defaults.easing]:this.easing[t]||this.easing[this.defaults.easing]:"function"==typeof t?t:this.easing[this.defaults.easing]},parseDurationOption:function(t){var e=n.durations;return"string"==typeof t?e[t]||e[n.defaults.duration]:t},runAnimation:function(t,e){var i,s,r,n;i=t.obj,r=t.options,t.advanceCallback=e,this.mainTimer.add(t);var s=this.parseProperties(t.properties,i);t.properties=s.properties,t.startValues=s.startValues,t.diffValues=s.diffValues,t.startTime=(new Date).getTime()},parseProperties:function(t,e){var i={},s={};for(var r in t)if(y.isNumber(t[r]))i[r]=e[r]||0,s[r]=t[r]-(e[r]||0);else if("object"==typeof t[r]){var n=this.parseProperties(t[r],e[r]);i[r]=n.startValues,s[r]=n.diffValues}else delete t[r];return{properties:t,startValues:i,diffValues:s}},tick:function(t){var e,i,s,r,n,a;if(1<(i=(e=(new Date).getTime()-t.startTime)/t.options.duration))return this.setEndValues(t),!1;for(a in s=1===t.options.easing.length?t.options.easing.call(this.easing,i):t.options.easing.call(this.easing,e,0,1,t.options.duration),r=t.startValues,n=t.diffValues)this.setObjectProperty(t.obj,a,r[a],n[a],s);return!0},setObjectProperty:function(t,e,i,s,r){if(y.isNumber(i))t[e]=i+s*r;else for(var n in i)this.setObjectProperty(t[e],n,i[n],s[n],r)},setEndValues:function(t){var e=t.obj,i=t.startValues,s=t.diffValues;for(var r in t.properties)this.setObjectProperty(e,r,i[r],s[r],1);this.core.timeline.running||this.core.draw.redraw(!0)},getAnimateArguments:function(t){var e,i,s,r;return"number"==typeof t[0]?e=t[0]:"string"==typeof t[0]?t[0]in this.durations?e=this.durations[t[0]]:t[0]in this.easing&&(i=this.easing[t[0]]):"boolean"==typeof t[0]?s=t[0]:"function"==typeof t[0]&&"function"==typeof t[1]&&(i=t[0],r=t[1]),"string"==typeof t[1]?i=this.easing[t[1]]:"function"==typeof t[1]&&(t[2]!==C?i=t[1]:r=t[1]),t[2]!==C&&("function"==typeof t[2]?r=t[2]:s=!!t[2]),t[3]!==C&&(r=t[3]),i||((i=~(i="string"==typeof t[0]?t[0]:"").indexOf("cubic-bezier")?i:C)||(i=~(i="string"==typeof t[1]?t[1]:"").indexOf("cubic-bezier")?i:C),i&&(i=this.getCustomCubicBezier(i))),{duration:e=e||this.durations[this.defaults.duration],easing:i=i||this.easing[this.defaults.easing],queue:(s=s!==C&&s)?C:"default",callback:r=r||function(){}}},getCustomCubicBezier:function(t){var e,i,s,r,n;if(e=t.match(/cubic-bezier\(\s*(.*?),\s*(.*?),\s*(.*?),\s*(.*?)\)/))return i=isNaN(parseFloat(e[1]))?0:parseFloat(e[1]),s=isNaN(parseFloat(e[2]))?0:parseFloat(e[2]),r=isNaN(parseFloat(e[3]))?1:parseFloat(e[3]),n=isNaN(parseFloat(e[4]))?1:parseFloat(e[4]),function(t){return this.cubicBezier(i,s,r,n,t)}},stop:function(t){for(var e in t.animationQueues)t.animationQueues[e].clear(!1)},finish:function(t){for(var e in t.animationQueues)t.animationQueues[e].clear(!0)},delay:function(t,e,i){var s=t.animationQueues[i&&i.queue||"default"];s&&s.add({type:"delay",duration:e||0})},mainTimer:{animations:[],add:function(t){this.animations.push(t),1===this.animations.length&&this.start()},remove:function(t){this.animations.splice(this.animations.indexOf(t),1),0===this.animations.length&&this.stop()},start:function(){this.tick()},stop:function(){cancelAnimationFrame(this.timer)},tick:function(){var r=this;setTimeout(function(){r.timer=requestAnimationFrame(function(){r.tick()});for(var t=r.animations,e,i=0,s=t.length;i<s;i++)(e=t[i]).cancelled||n.tick(e)||(n.mainTimer.remove(e),i--,s--,e.advanceCallback(),e.options.callback.call(e.obj));n.core.timeline.running||n.core.draw.redraw(!0)},1e3/n.core.settings.fps)}},queues:{create:function(t,e){return e===C&&(e=Math.round((new Date).getTime()*Math.random()).toString()),t.animationQueues[e]||(t.animationQueues[e]={name:e,list:[],isRunning:!1,add:function(t){this.list.push(t)},remove:function(t){if(t){var e=this.list.indexOf(t);~e&&this.list.splice(e,1)}else this.list.shift()},run:function(){if(!this.isRunning&&0<this.list.length){this.isRunning=!0;var t=this.list[0],e=this;"delay"===t.type?setTimeout(function(){e.advance()},t.duration):n.runAnimation(t,function(){e.advance()})}},advance:function(){this.list.shift(),this.isRunning=!1,this.run()},clear:function(t){if(this.isRunning){var e=this.list[0];e.cancelled=!0,t&&(n.setEndValues(e),e.options.callback.call(e.obj)),this.isRunning=!1,n.mainTimer.remove(e)}this.list.length=0}}),this.get(t,e)},get:function(t,e){return t.animationQueues[e]}},easing:{"ease-in":function(t){return this.cubicBezier(.42,0,1,1,t)},"ease-out":function(t){return this.cubicBezier(0,0,.58,1,t)},"ease-in-out":function(t){return this.cubicBezier(.42,0,.58,1,t)},linear:function(t){return t},"ease-in-quad":function(t,e,i,s){return i*(t/=s)*t+e},"ease-out-quad":function(t,e,i,s){return-i*(t/=s)*(t-2)+e},"ease-in-out-quad":function(t,e,i,s){return(t/=s/2)<1?i/2*t*t+e:-i/2*(--t*(t-2)-1)+e},"ease-in-cubic":function(t,e,i,s){return i*(t/=s)*t*t+e},"ease-out-cubic":function(t,e,i,s){return i*((t=t/s-1)*t*t+1)+e},"ease-in-out-cubic":function(t,e,i,s){return(t/=s/2)<1?i/2*t*t*t+e:i/2*((t-=2)*t*t+2)+e},"ease-in-quart":function(t,e,i,s){return i*(t/=s)*t*t*t+e},"ease-out-quart":function(t,e,i,s){return-i*((t=t/s-1)*t*t*t-1)+e},"ease-in-out-quart":function(t,e,i,s){return(t/=s/2)<1?i/2*t*t*t*t+e:-i/2*((t-=2)*t*t*t-2)+e},"ease-in-quint":function(t,e,i,s){return i*(t/=s)*t*t*t*t+e},"ease-out-quint":function(t,e,i,s){return i*((t=t/s-1)*t*t*t*t+1)+e},"ease-in-out-quint":function(t,e,i,s){return(t/=s/2)<1?i/2*t*t*t*t*t+e:i/2*((t-=2)*t*t*t*t+2)+e},"ease-in-sine":function(t,e,i,s){return-i*Math.cos(t/s*(Math.PI/2))+i+e},"ease-out-sine":function(t,e,i,s){return i*Math.sin(t/s*(Math.PI/2))+e},"ease-in-out-sine":function(t,e,i,s){return-i/2*(Math.cos(Math.PI*t/s)-1)+e},"ease-in-expo":function(t,e,i,s){return 0==t?e:i*Math.pow(2,10*(t/s-1))+e},"ease-out-expo":function(t,e,i,s){return t==s?e+i:i*(1-Math.pow(2,-10*t/s))+e},"ease-in-out-expo":function(t,e,i,s){return 0==t?e:t==s?e+i:(t/=s/2)<1?i/2*Math.pow(2,10*(t-1))+e:i/2*(2-Math.pow(2,-10*--t))+e},"ease-in-circ":function(t,e,i,s){return-i*(Math.sqrt(1-(t/=s)*t)-1)+e},"ease-out-circ":function(t,e,i,s){return i*Math.sqrt(1-(t=t/s-1)*t)+e},"ease-in-out-circ":function(t,e,i,s){return(t/=s/2)<1?-i/2*(Math.sqrt(1-t*t)-1)+e:i/2*(Math.sqrt(1-(t-=2)*t)+1)+e},"ease-in-elastic":function(t,e,i,s,r,n){if(0==t)return e;if(1==(t/=s))return e+i;if(n||(n=.3*s),(r=r||0)<Math.abs(i)){r=i;var a=n/4}else var a=n/(2*Math.PI)*Math.asin(i/r);return-r*Math.pow(2,10*(t-=1))*Math.sin((t*s-a)*(2*Math.PI)/n)+e},"ease-out-elastic":function(t,e,i,s,r,n){if(0==t)return e;if(1==(t/=s))return e+i;if(n||(n=.3*s),(r=r||0)<Math.abs(i)){r=i;var a=n/4}else var a=n/(2*Math.PI)*Math.asin(i/r);return r*Math.pow(2,-10*t)*Math.sin((t*s-a)*(2*Math.PI)/n)+i+e},"ease-in-out-elastic":function(t,e,i,s,r,n){if(0==t)return e;if(2==(t/=s/2))return e+i;if(n||(n=s*(.3*1.5)),(r=r||0)<Math.abs(i)){r=i;var a=n/4}else var a=n/(2*Math.PI)*Math.asin(i/r);return t<1?r*Math.pow(2,10*(t-=1))*Math.sin((t*s-a)*(2*Math.PI)/n)*-.5+e:r*Math.pow(2,-10*(t-=1))*Math.sin((t*s-a)*(2*Math.PI)/n)*.5+i+e},"ease-in-back":function(t,e,i,s,r){return r==C&&(r=1.70158),i*(t/=s)*t*((r+1)*t-r)+e},"ease-out-back":function(t,e,i,s,r){return r==C&&(r=1.70158),i*((t=t/s-1)*t*((r+1)*t+r)+1)+e},"ease-in-out-back":function(t,e,i,s,r){return r==C&&(r=1.70158),(t/=s/2)<1?i/2*(t*t*((1+(r*=1.525))*t-r))+e:i/2*((t-=2)*t*((1+(r*=1.525))*t+r)+2)+e},"ease-in-bounce":function(t,e,i,s){return i-this["ease-out-bounce"](s-t,0,i,s)+e},"ease-out-bounce":function(t,e,i,s){return(t/=s)<1/2.75?i*(7.5625*t*t)+e:t<2/2.75?i*(7.5625*(t-=1.5/2.75)*t+.75)+e:t<2.5/2.75?i*(7.5625*(t-=2.25/2.75)*t+.9375)+e:i*(7.5625*(t-=2.625/2.75)*t+.984375)+e},"ease-in-out-bounce":function(t,e,i,s){return t<s/2?.5*this["ease-in-bounce"](2*t,0,i,s)+e:.5*this["ease-out-bounce"](2*t-s,0,i,s)+.5*i+e},cubicBezier:function(t,e,i,s,r){var n=0,a=0,o=1,h=1,c=1-3*i+3*t-0,l=3*i-6*t+0,d=3*t-0,u=0,f=1-3*s+3*e-0,g=3*s-6*e+0,p=3*e-0,y=0,b=r,_=5,v,m,x,w;for(v=0;v<5;v++)b=1<(b-=((x=c*b*b*b+l*b*b+d*b+0)-r)*(m=1/(3*c*b*b+2*l*b+d)))?1:b<0?0:b;return w=Math.abs(f*b*b*b+g*b*b+p*b*0)}}};return n};y.registerModule("animation",u);var f=function(){var e=function(t,e,i,s,r){var n=r.style.getStroke(t.stroke);n[e]=i,t.stroke=r.style.getStroke(n,"string")};return{id:0,shapeType:"rectangular",type:"",origin:{x:0,y:0},events:{},children:[],added:!1,opacity:1,rotation:0,composition:"source-over",scalingX:1,scalingY:1,pointerEvents:!0,animationQueues:{},_:{x:0,y:0,abs_x:0,abs_y:0,rotation:0,width:0,height:0,drawn:!1,stroke:"",strokeColor:"black",strokeWidth:0,strokePosition:"center",cap:"butt",join:"miter",miterLimit:10,fill:"",shadow:{offsetX:0,offsetY:0,blur:0,color:"transparent"}},set strokeColor(t){e(this,"color",t,"strokeColor",this.core)},set strokeWidth(t){e(this,"width",t,"strokeWidth",this.core)},set strokePosition(t){e(this,"pos",t,"strokePosition",this.core)},set stroke(t){"string"!=typeof t&&(t=this.core.style.getStroke(t,"string"));var e=this.core.style.getStroke(t);if(~e.color.indexOf("image(")){var i=/image\((.*?)(,(\s|)(repeat|repeat-x|repeat-y|no-repeat)|)\)/.exec(e.color),s=i[1],r=i[4]||"repeat",n=new Image,a=this;n.src=s,this._.strokepattern_loading=!0,this._.strokepattern_redraw=!1,n.onload=function(){a._.strokeColor=a.core.canvas.createPattern(this,r),a._.strokepattern_loading=!1,a._.strokepattern_redraw&&(a._.strokepattern_redraw=!1,a.redraw())}}else this._.strokeColor=e.color;this._.strokeWidth=e.width,this._.strokePosition=e.pos,this._.stroke=t},set cap(t){var e=["butt","round","square"];this._.cap=~e.indexOf(t)?t:"butt"},set join(t){var e=["round","bevel","miter"];this._.join=~e.indexOf(t)?t:"miter"},set miterLimit(t){this._.miterLimit=isNaN(parseFloat(t))?10:parseFloat(t)},get stroke(){return this._.stroke},get strokeColor(){if(this._.strokepattern_loading)return this._.strokepattern_redraw=!0,"";if(~this._.strokeColor.toString().indexOf("CanvasPattern"))return this._.strokeColor;if(!~this._.strokeColor.indexOf("gradient"))return this._.strokeColor;var t=this.getOrigin();if("rectangular"===this.shapeType){var e="outside"===this.strokePosition?this.strokeWidth:"center"===this.strokePosition?this.strokeWidth/2:0;return this.core.style.getGradient(this._.strokeColor,this.abs_x-t.x-e,this.abs_y-t.y-e,this.width+2*e,this.height+2*e)}if("radial"===this.shapeType){var i=this.radius+this.strokeWidth/2;return t.x+=this.radius,t.y+=this.radius,this.core.style.getGradient(this._.strokeColor,this.abs_x-t.x-this.radius,this.abs_y-t.y-this.radius,2*i,2*i)}},get strokeWidth(){return this._.strokeWidth},get strokePosition(){return this._.strokePosition},get cap(){return this._.cap},get join(){return this._.join},get miterLimit(){return this._.miterLimit},set fill(t){if(~t.indexOf("image(")){var e=/image\((.*?)(,(\s|)(repeat|repeat-x|repeat-y|no-repeat)|)\)/.exec(t),i=e[1],s=e[4]||"repeat",r=new Image,n=this;r.src=i,this._.pattern_loading=!0,this._.pattern_redraw=!1,r.onload=function(){n._.fill=n.core.canvas.createPattern(this,s),n._.pattern_loading=!1,n._.pattern_redraw&&(n._.pattern_redraw=!1,n.redraw())}}else this._.fill=t},get fill(){if(this._.pattern_loading)return this._.pattern_redraw=!0,"";if(~this._.fill.toString().indexOf("CanvasPattern"))return this._.fill;if(!~this._.fill.indexOf("gradient"))return this._.fill;var t=this.getOrigin();return"rectangular"===this.shapeType?this.core.style.getGradient(this._.fill,this.abs_x-t.x,this.abs_y-t.y,this.width,this.height):"radial"===this.shapeType?this.core.style.getGradient(this._.fill,this.abs_x-t.x-this.radius,this.abs_y-t.y-this.radius,2*this.radius,2*this.radius):void 0},set shadow(t){"string"!=typeof t&&(t=this.core.style.getShadow(t,"string"));var e=this.core.style.getShadow(t);this._.shadow=e},set shadowOffsetX(t){isNaN(parseFloat(t))||(this._.shadow.offsetX=parseFloat(t))},set shadowOffsetY(t){isNaN(parseFloat(t))||(this._.shadow.offsetY=parseFloat(t))},set shadowBlur(t){isNaN(parseFloat(t))||(this._.shadow.blur=parseFloat(t))},set shadowColor(t){this.core.style.isColor(t)&&(this._.shadow.color=t)},get shadow(){return this._.shadow},get shadowOffsetX(){return this._.shadow.offsetX},get shadowOffsetY(){return this._.shadow.offsetY},get shadowBlur(){return this._.shadow.blur},get shadowColor(){return this._.shadow.color},set x(t){this._.x=t,this._.abs_x=t+(this.parent!==C&&this.parent!==this.core?this.parent.abs_x:0);var e=this.children,i=e.length,s;for(s=0;s<i;s++)e[s]._.abs_x=this.abs_x+e[s].x,e[s].x+=0},set y(t){this._.y=t,this._.abs_y=t+(this.parent!==C&&this.parent!==this.core?this.parent.abs_y:0);var e=this.children,i=e.length,s;for(s=0;s<i;s++)e[s]._.abs_y=this.abs_y-e[s].y,e[s].y+=0},get x(){return this._.x},get y(){return this._.y},set abs_x(t){},set abs_y(t){},get abs_x(){return this._.abs_x},get abs_y(){return this._.abs_y},set width(t){this._.width=t},get width(){return this._.width},set height(t){this._.height=t},get height(){return this._.height},set zIndex(t){this.parent&&("front"===t&&(t=this.parent.children.length-1),"back"===t&&(t=0),this.core.draw.changeZorder(this.parent,this.zIndex,t))},get zIndex(){return this.parent&&this.parent.children.indexOf(this)},get drawn(){return!this.core.draw.isCleared&&this._.drawn},set drawn(t){this._.drawn=!!t},bind:function(t,e){return this.core.events.bind(this,t.split(" "),e),this},unbind:function(t,e){return this.core.events.unbind(this,t.split(" "),e),this},trigger:function(t,e){var i=this.core.events,s=i.getParentChain(this,!0,!0);return i.triggerChain(s,t.split(" "),i.fixEventObject(e)),this},add:function(t){return this.addAt(this.core.children.length,t)},addAt:function(t,e){return this.added||(e=e===C||e,t>=this.core.children.length?this.core.children.push(this):t<0?this.core.children.unshift(this):this.core.children.splice(t,0,this),this.added=!0,this.parent=this.core,this.core.draw.objects.push(this),e&&this.core.draw.redraw()),this},remove:function(t){if(t=t===C||t,!this.parent)return this;var e=this.parent.children.indexOf(this);if(~e){this.parent.children.splice(e,1),this.parent=C,this.added=!1,this.drawn=!1;var i=this.core.draw.objects.indexOf(this);~i&&this.core.draw.objects.splice(r,1);for(var s=this.children,r=0,n=s.length;r<n;r++)s[r].drawn=!1,~(i=this.core.draw.objects.indexOf(s[r]))&&this.core.draw.objects.splice(i,1);t&&this.core.draw.redraw()}return this},draw:function(){},redraw:function(){return this.core.draw.redraw(),this},rotate:function(t){return this.rotation+=t,this},rotateTo:function(t){return this.rotation=t,this},getArgs:function(t,e,i,s){if(i=i||0,s=s||0,"string"==typeof e){var r=e,n=t;t="x"===e?n:i,e="y"===e?n:s}else e===C&&(e=t);return{x:t,y:e}},move:function(t,e){var i=this.getArgs(t,e);return this.x+=i.x,this.y+=i.y,this},moveTo:function(t,e){var i=this.getArgs(t,e,this.x,this.y);return this.x=i.x,this.y=i.y,this},scale:function(t,e){var i=this.getArgs(t,e,1,1);return this.scalingX=i.x,this.scalingY=i.y,this},scaleTo:function(t,e){var i="rectangular"===this.shapeType?this.width:this.radius,s="rectangular"===this.shapeType?this.height:this.radius,r=this.getArgs(t,e,i,s);return r.x=r.x<=0?1:r.x,r.y=r.y<=0?1:r.y,this.scalingX=r.x/i,this.scalingY=r.y/s,this},animate:function(){return this.core.animation.animate(this,arguments),this},stop:function(){return this.core.animation.stop(this),this},finish:function(){return this.core.animation.finish(this),this},delay:function(t,e){return this.core.animation.delay(this,t,e),this},fadeIn:function(){var t=Array.prototype.slice.call(arguments);return this.core.animation.animate(this,[{opacity:1}].concat(t)),this},fadeOut:function(){var t=Array.prototype.slice.call(arguments);return this.core.animation.animate(this,[{opacity:0}].concat(t)),this},fadeTo:function(){var t=Array.prototype.slice.call(arguments);return this.core.animation.animate(this,[{opacity:t.splice(0,1)[0]}].concat(t)),this},dragAndDrop:function(i){if(!1===(i=i===C?{}:i)&&!0===this.draggable)this.draggable=!1,this.unbind("mousedown touchstart",this._.drag_start),this.core.unbind("mouseup touchend",this._.drag_end),this.core.unbind("mousemove touchmove",this._.drag_move);else if(!this.draggable){this.draggable=!0,this.dragging=!1;var s=this,e={x:0,y:0},r={x:0,y:0},n={x:0,y:0};this._.drag_start=function(t){!1===i.bubble&&t.stopPropagation(),this.dragging=!0,e.x=t.x-this.x,e.y=t.y-this.y,r.x=this.x,r.y=this.y,n=s.core.tools.transformPointerPosition(s,s.abs_x,s.abs_y,s.rotation),!0===i.changeZindex&&(this.zIndex="front"),"function"==typeof i.start&&i.start.call(this),this.core.timeline.running||this.core.draw.redraw()},this._.drag_end=function(t){s.dragging&&(!1===i.bubble&&t.stopPropagation(),s.dragging=!1,"function"==typeof i.end&&i.end.call(s),s.core.timeline.running||s.core.draw.redraw())},this._.drag_move=function(t){if(s.dragging){!1===i.bubble&&t.stopPropagation();var e=s.core.tools.transformPointerPosition(s,s.abs_x,s.abs_y,s.rotation);s.x=r.x+e.x-n.x,s.y=r.y+e.y-n.y,"function"==typeof i.move&&i.move.call(s),s.core.timeline.running||s.core.draw.redraw()}},this.bind("mousedown touchstart",this._.drag_start),this.core.bind("mouseup touchend",this._.drag_end),this.core.bind("mousemove touchmove",this._.drag_move)}return this},setOrigin:function(t,e){return this.origin.x=t,this.origin.y=e,this},getOrigin:function(){var t,e,i=this.origin,s=this.shapeType;return{x:t="center"===i.x?"rectangular"===s?this.width/2:0:"right"===i.x?"rectangular"===s?this.width:this.radius:"left"===i.x?"rectangular"===s?0:-this.radius:isNaN(parseFloat(i.x))?0:parseFloat(i.x),y:e="center"===i.y?"rectangular"===s?this.height/2:0:"bottom"===i.y?"rectangular"===s?this.height:this.radius:"top"===i.y?"rectangular"===s?0:-this.radius:isNaN(parseFloat(i.y))?0:parseFloat(i.y)}},addChild:function(t,e){return this.addChildAt(t,this.children.length,e)},addChildAt:function(t,e,i){var s;if(t.parent===C){if(s=e>=this.children.length?this.children.push(t)-1:e<0?(this.children.unshift(t),0):(this.children.splice(e,0,t),e),t.parent=this,t.x+=0,t.y+=0,this.core.draw.objects.push(t),this.drawn&&this.core.draw.redraw(),i)return s}else if(i)return!1;return this},removeChild:function(t,e){var i=this.children.indexOf(t);return~i&&this.removeChildAt(i,e),this},removeChildAt:function(t,e){return this.children[t]!==C&&this.children[t].remove(e),this},clone:function(t){(t=t||{}).drawn=!1;var s=this.parent,e=this.core.display[this.type](t),i={},r=["core","events","children","parent","img","image","fill","strokeColor","added"],n=["abs_x","start_x","end_x"],a=["abs_y","start_y","end_y"],o,h,c,l,d,u,f,g,p;if((o=function(t,e){for(h in t)if(!~r.indexOf(h)&&(p=Object.getPropertyDescriptor(t,h))&&p.get===C){if("object"==typeof t[h]){e[h]=t[h].constructor===Array?[]:{},o(t[h],e[h]);continue}var i=t[h];s&&(-1<n.indexOf(h)?i-=s.abs_x:-1<a.indexOf(h)&&(i-=s.abs_y)),e[h]=i}})(this,i),i.fill=this._.fill,c=this.core.style.getStroke(this.stroke),i.strokeColor=c.color,this.image&&(i.image=this.image),(e=y.extend(e,i,t)).id=++this.core.lastObjectID,"function"==typeof e.init&&e.init(),0<(d=this.children).length)for(l=0;l<d.length;l++)u=d[l].clone(),e.children.push(u),u.parent=e,t.x&&(f=Math.abs(d[l].abs_x-this.x),u.x=f),t.y&&(g=Math.abs(d[l].abs_y-this.y),u.y=g);return e},isPointerInside:function(t){return this.core.tools.isPointerInside(this,t)}}},g=function(i,s,r,n){var t=this,a=this.core,o=function(t,e){return y.extend({core:e,type:i,shapeType:"rectangular",draw:function(){return r.call(this,a.canvas,a),this}},s,t)};return this[i]=function(t){var e=y.extend(Object.create(f()),new o(t,a));return n!==C&&"function"==typeof e[n]&&e[n](),e},t};y.registerModule("displayObject",f),y.registerModule("display",{wrapper:!0,register:g}),y.registerDisplayObject=function(s,r,n){y.registerModule("display."+s,{setCore:function(i){return function(t){var e=y.extend(Object.create(f()),new r(t,i));return e.type=s,e.id=++i.lastObjectID,i.animation.queues.create(e,"default"),n!==C&&e[n](),e}}})};var p=function(t,e){function s(t,e){return Math.max(Math.min(t,e),0)}function a(t,e,i){return t!==C?s(t,i):e!==C?s(e,i):0}function o(t,e,i,s,r,n){return{topLeft:a(e,t,n),topRight:a(i,t,n),bottomLeft:a(s,t,n),bottomRight:a(r,t,n)}}function h(t,e){return 0<e?{topLeft:0===t.topLeft?0:t.topLeft+e,topRight:0===t.topRight?0:t.topRight+e,bottomLeft:0===t.bottomLeft?0:t.bottomLeft+e,bottomRight:0===t.bottomRight?0:t.bottomRight+e}:e<0?{topLeft:Math.max(t.topLeft+e,0),topRight:Math.max(t.topRight+e,0),bottomLeft:Math.max(t.bottomLeft+e,0),bottomRight:Math.max(t.bottomRight+e,0)}:t}function c(t){return 0<t.topLeft||0<t.topRight||0<t.bottomLeft||0<t.bottomRight}function l(t,e,i,s,r,n,a){var o=e+s,h=i+r;a?(t.moveTo(o-n.topRight,i),t.arcTo(e,i,e,i+n.topLeft,n.topLeft),t.arcTo(e,h,e+n.bottomLeft,h,n.bottomLeft),t.arcTo(o,h,o,h-n.bottomRight,n.bottomRight),t.arcTo(o,i,o-n.topRight,i,n.topRight)):(t.moveTo(e+n.topLeft,i),t.arcTo(o,i,o,i+n.topRight,n.topRight),t.arcTo(o,h,o-n.bottomRight,h,n.bottomRight),t.arcTo(e,h,e,h-n.bottomLeft,n.bottomLeft),t.arcTo(e,i,e+n.topLeft,i,n.topLeft))}return y.extend({core:e,shapeType:"rectangular",clipChildren:!1,_:y.extend({},e.displayObject._,{borderTopLeftRadius:0,borderTopRightRadius:0,borderBottomRightRadius:0,borderBottomLeftRadius:0,borderRadius:0}),set borderTopLeftRadius(t){this._.borderTopLeftRadius=parseFloat(t,10)},get borderTopLeftRadius(){return this._.borderTopLeftRadius},set borderTopRightRadius(t){this._.borderTopRightRadius=parseFloat(t,10)},get borderTopRightRadius(){return this._.borderTopRightRadius},set borderBottomRightRadius(t){this._.borderBottomRightRadius=parseFloat(t,10)},get borderBottomRightRadius(){return this._.borderBottomRightRadius},set borderBottomLeftRadius(t){this._.borderBottomLeftRadius=parseFloat(t,10)},get borderBottomLeftRadius(){return this._.borderBottomLeftRadius},set borderRadius(t){var e=parseFloat(t,10);this._.borderRadius=e,this._.borderTopLeftRadius=e,this._.borderTopRightRadius=e,this._.borderBottomRightRadius=e,this._.borderBottomLeftRadius=e},get borderRadius(){var t=this._.borderTopLeftRadius,e=this._.borderTopRightRadius,i=this._.borderBottomRightRadius,s=this._.borderBottomLeftRadius;return t===e&&e===i&&i===s&&(this._.borderRadius=t),this._.borderRadius},draw:function(){var t=this.core.canvas,e=this.getOrigin(),i=this.abs_x-e.x,s=this.abs_y-e.y,r=o(this.borderRadius,this.borderTopLeftRadius,this.borderTopRightRadius,this.borderBottomLeftRadius,this.borderBottomRightRadius,Math.min(this.width,this.height)/2);if(c(r)){t.beginPath(),l(t,i,s,this.width,this.height,r),t.closePath(),""!==this.fill&&(t.fillStyle=this.fill,t.fill());var n=!1;0<this.strokeWidth&&("center"===this.strokePosition?(t.lineWidth=this.strokeWidth,t.strokeStyle=this.strokeColor,t.stroke()):(t.beginPath(),"inside"===this.strokePosition?(l(t,i,s,this.width,this.height,r),l(t,i+this.strokeWidth,s+this.strokeWidth,this.width-2*this.strokeWidth,this.height-2*this.strokeWidth,h(r,-this.strokeWidth),!0)):"outside"===this.strokePosition&&(l(t,i-this.strokeWidth,s-this.strokeWidth,this.width+2*this.strokeWidth,this.height+2*this.strokeWidth,h(r,this.strokeWidth),!0),l(t,i,s,this.width,this.height,r)),t.closePath(),t.fillStyle=this.strokeColor,t.fill(),n=!0)),this.clipChildren&&(n&&(t.beginPath(),l(t,i,s,this.width,this.height,r),t.closePath()),t.clip())}else t.beginPath(),t.rect(i,s,this.width,this.height),t.closePath(),""!==this.fill&&(t.fillStyle=this.fill,t.fill()),0<this.strokeWidth&&(t.lineWidth=this.strokeWidth,t.strokeStyle=this.strokeColor,"outside"===this.strokePosition?t.strokeRect(i-this.strokeWidth/2,s-this.strokeWidth/2,this.width+this.strokeWidth,this.height+this.strokeWidth):"center"===this.strokePosition?t.strokeRect(i,s,this.width,this.height):"inside"===this.strokePosition&&t.strokeRect(i+this.strokeWidth/2,s+this.strokeWidth/2,this.width-this.strokeWidth,this.height-this.strokeWidth)),this.clipChildren&&t.clip();return this}},t)};y.registerDisplayObject("rectangle",p);var b=function(t,e){return y.extend({core:e,_:y.extend({},e.displayObject._,{hasBeenDrawn:!1}),shapeType:"rectangular",loaded:!1,firstDrawn:!1,tile:!1,tile_width:0,tile_height:0,tile_spacing_x:0,tile_spacing_y:0,clipChildren:!1,init:function(){var t=this,e;if(this.image!==C){var i=this.image.nodeName&&"img"===this.image.nodeName.toLowerCase();this.img=i?this.image:new Image;var s=function(){t.loaded=!0,0!==t.width?0===t.height&&(t.height=t.width/(this.width/this.height)):t.width=this.width,0!==t.height?0===t.width&&(t.width=t.height/(this.height/this.width)):t.height=this.height,t.tile_width=0===t.tile_width?t.width:t.tile_width,t.tile_height=0===t.tile_height?t.height:t.tile_height,t._.hasBeenDrawn&&t.core.redraw()};i&&this.img.complete?s.call(this.img):(this.img.addEventListener("load",s),i||(this.img.src=this.image))}},draw:function(){var t=this.core.canvas,e=this,i=this.getOrigin(),s=this.abs_x-i.x,r=this.abs_y-i.y,n,a;if(this.loaded&&this.core.draw.objects[this.zIndex]!==C&&0<this.img.width&&0<this.img.height){if(n=0===this.width?this.img.width:this.width,a=0===this.height?this.img.height:this.height,this.tile){var o=Math.ceil(n/this.tile_width),h=Math.ceil(a/this.tile_height),c,l;for(t.save(),t.beginPath(),t.moveTo(s,r),t.lineTo(s+n,r),t.lineTo(s+n,r+a),t.lineTo(s,r+a),t.lineTo(s,r),t.clip(),l=0;l<h;l++)for(c=0;c<o;c++)t.drawImage(this.img,s+c*(this.tile_width+this.tile_spacing_x),r+l*(this.tile_height+this.tile_spacing_y),this.tile_width,this.tile_height);t.closePath(),t.restore()}else t.drawImage(this.img,s,r,n,a);0<this.strokeWidth&&(t.lineWidth=this.strokeWidth,t.strokeStyle=this.strokeColor,t.strokeRect(s,r,n,a)),!1===this.firstDrawn&&(this.firstDrawn=!0,clearTimeout(this.loadtimer))}else clearTimeout(this.loadtimer),this.loadtimer=setTimeout(function(){e.draw()},100);return this.clipChildren&&(t.beginPath(),t.rect(s,r,n,a),t.closePath(),t.clip()),this._.hasBeenDrawn=!0,this}},t)};y.registerDisplayObject("image",b,"init");var _=[],v=function(t,e){var i=function(t,e,i,s,r){var n=r.style.getFont(t.font);n[e]=i,t._.font=r.style.getFont(n,"string"),"lineHeight"===s?(t._.lineHeight=isNaN(parseInt(i,10))?1:parseInt(i,10),t._.lineHeightUnit="string"==typeof i&&-1<i.indexOf("px")?"px":"relative"):t._[s]=i};return y.extend({core:e,shapeType:"rectangular",align:"start",baseline:"top",_:y.extend({},
e.displayObject._,{hasBeenDrawn:!1,font:"normal normal normal 16px/1 sans-serif",style:"normal",variant:"normal",weight:"normal",size:16,lineHeight:1,family:"sans-serif",text:"",width:0,height:0,lines:[]}),set font(t){"string"!=typeof t&&(t=this.core.style.getFont(t,"string"));var e=this.core.style.getFont(t);t=this.core.style.getFont(e,"string"),this._.style=e.style,this._.variant=e.variant,this._.weight=e.weight,this._.size=e.size,this._.lineHeight=e.lineHeight,this._.lineHeightUnit=e.lineHeightUnit,this._.family=e.family,this._.font=t,this.initWebFont(),this.setDimensions()},set style(t){i(this,"style",t,"style",this.core),this.initWebFont(),this.setDimensions()},set variant(t){i(this,"variant",t,"variant",this.core),this.initWebFont(),this.setDimensions()},set weight(t){i(this,"weight",t,"weight",this.core),this.initWebFont(),this.setDimensions()},set size(t){i(this,"size",t,"size",this.core),this.setDimensions()},set lineHeight(t){i(this,"lineHeight",t,"lineHeight",this.core),this.setDimensions()},set family(t){i(this,"family",t,"family",this.core),this.initWebFont(),this.setDimensions()},set text(t){this._.text=t,this.setDimensions()},set width(t){},set height(t){},get font(){return this._.font},get style(){return this._.style},get variant(){return this._.variant},get weight(){return this._.weight},get size(){return this._.size},get lineHeight(){return this._.lineHeight+("px"===this._.lineHeightUnit?"px":0)},get family(){return this._.family},get text(){return this._.text},get width(){return this._.width},get height(){return this._.height},init:function(){this._.initialized=!0,this.initWebFont(),this.setDimensions()},setDimensions:function(){if(this._.initialized){var t,e,i,s,r,n,a,o,h;for((t=this.core.canvas).fillStyle=this.fill,t.font=this.font,i=(e=this.text.toString().split("\n")).length,h=[],a=n=r=0;a<i;a++)r=(o=t.measureText(e[a])).width>r?o.width:r,n+=s="px"===this._.lineHeightUnit?this._.lineHeight:this.size*this._.lineHeight,h.push({text:e[a],width:o.width,height:s});this._.width=r,this._.height=n,this._.lines=h}},initWebFont:function(){var t=this.style+" "+this.variant+" "+this.weight+" 0px "+this.family;if(!(-1<_.indexOf(t))){_.push(t);var e=this,i=this.core,s;(s=d.createElement("span")).style.font=t,d.body.appendChild(s),setTimeout(function(){d.body.removeChild(s),e._.hasBeenDrawn&&i.redraw()},1e3)}},getAlignOffset:function(){var t;return{start:"rtl"===this.core.canvasElement.dir?-this.width:0,end:"rtl"===this.core.canvasElement.dir?0:-this.width,left:0,center:-this.width/2,right:-this.width}[this.align]||0},getBaselineOffset:function(){var t;return{top:.82*this.size,hanging:.65*this.size,middle:.31*this.size,alphabetic:0,ideographic:-.05*this.size,bottom:-.22*this.size}[this.baseline]||0},draw:function(){var t,e,i,s,r,n,a,o,h,c,l;if(t=this.core.canvas,e=this._.lines,i=this.getAlignOffset(),s=this.getBaselineOffset(),r="px"===this._.lineHeightUnit?this._.lineHeight/this.size:this._.lineHeight,n="top"!==this.baseline?this.size*(r-1)/2:0,a=this.getOrigin(),o=this.abs_x-a.x-i,h=this.abs_y-a.y+s-n,t.beginPath(),t.font=this.font,t.textAlign=this.align,t.textBaseline="alphabetic",0<this.strokeWidth)for(t.lineWidth=this.strokeWidth,t.strokeStyle=this.strokeColor,c=0,l=e.length;c<l;c++)t.strokeText(e[c].text,o,h+c*e[c].height+(e[c].height-this.size)/2);if(""!==this.fill)for(t.fillStyle=this.fill,c=0,l=e.length;c<l;c++)t.fillText(e[c].text,o,h+c*e[c].height+(e[c].height-this.size)/2);return t.closePath(),this._.hasBeenDrawn=!0,this}},t)};y.registerDisplayObject("text",v,"init");var m=function(t,e){return y.extend({core:e,shapeType:"radial",radius:0,start:0,end:0,direction:"clockwise",pieSection:!1,clipChildren:!1,draw:function(){var t=this.core.canvas,e=this.getOrigin(),i=this.abs_x-e.x,s=this.abs_y-e.y;return t.beginPath(),0<this.radius&&this.start!==this.end&&(this.pieSection&&t.moveTo(i,s),t.arc(i,s,this.radius,this.start*Math.PI/180,this.end*Math.PI/180,"anticlockwise"===this.direction),""!==this.fill&&(t.fillStyle=this.fill,t.fill()),0<this.strokeWidth&&(t.lineWidth=this.strokeWidth,t.strokeStyle=this.strokeColor,t.stroke())),t.closePath(),this.clipChildren&&t.clip(),this}},t)};y.registerDisplayObject("arc",m);var x=function(t,e){return y.extend({core:e,shapeType:"radial",clipChildren:!1,_:y.extend({},e.displayObject._,{radius_x:0,radius_y:0}),set radius(t){this._.radius_x=t,this._.radius_y=t},set radius_x(t){this._.radius_x=t},set radius_y(t){this._.radius_y=t},get radius(){return this._.radius_x},get radius_x(){return this._.radius_x},get radius_y(){return this._.radius_y},getOrigin:function(){var t=0,e=0,i=this.origin;return{x:t="right"===this.origin.x?this.radius_x:"left"===this.origin.x?-this.radius_x:isNaN(parseFloat(this.origin.x))?0:parseFloat(this.origin.x),y:e="bottom"===this.origin.y?this.radius_y:"top"===this.origin.y?-this.radius_y:isNaN(parseFloat(this.origin.y))?0:parseFloat(this.origin.y)}},draw:function(){var t=this.core.canvas,e=this.getOrigin(),i=this.abs_x-e.x,s=this.abs_y-e.y;if(t.beginPath(),this.radius_x===this.radius_y)t.arc(i,s,this.radius_x,0,2*Math.PI,!1);else{var r=.276142374915397,n=2*this.radius_x*r,a=2*this.radius_y*r;t.moveTo(i-this.radius_x,s),t.bezierCurveTo(i-this.radius_x,s-a,i-n,s-this.radius_y,i,s-this.radius_y),t.bezierCurveTo(i+n,s-this.radius_y,i+this.radius_x,s-a,i+this.radius_x,s),t.bezierCurveTo(i+this.radius_x,s+a,i+n,s+this.radius_y,i,s+this.radius_y),t.bezierCurveTo(i-n,s+this.radius_y,i-this.radius_x,s+a,i-this.radius_x,s)}return""!==this.fill&&(t.fillStyle=this.fill,t.fill()),0<this.strokeWidth&&(t.lineWidth=this.strokeWidth,t.strokeStyle=this.strokeColor,t.stroke()),t.closePath(),this.clipChildren&&t.clip(),this}},t)};y.registerDisplayObject("ellipse",x);var w=function(t,e){return y.extend({core:e,shapeType:"radial",sides:3,clipChildren:!1,_:y.extend({},e.displayObject._,{radius:0,side:0}),set radius(t){this._.radius=t,this._.side=2*this._.radius*Math.sin(Math.PI/this.sides)},set side(t){this._.side=t,this._.radius=this._.side/2/Math.sin(Math.PI/this.sides)},get radius(){return this._.radius},get side(){return this._.side},draw:function(){var t=this.core.canvas,e=this.getOrigin(),i=this.abs_x-e.x,s=this.abs_y-e.y,r={x:0,y:0},n=this.sides,a=this.radius,o,h,c;for(t.beginPath(),c=0;c<=n;c++)o=i+a*Math.cos(2*c*Math.PI/n),h=s+a*Math.sin(2*c*Math.PI/n),0===c?(t.moveTo(o,h),r={x:o,y:h}):c==n?t.lineTo(r.x,r.y):t.lineTo(o,h);return t.closePath(),""!==this.fill&&(t.fillStyle=this.fill,t.fill()),0<this.strokeWidth&&(t.lineWidth=this.strokeWidth,t.strokeStyle=this.strokeColor,t.stroke()),this.clipChildren&&t.clip(),this}},t)};y.registerDisplayObject("polygon",w);var O=function(t,e){return y.extend({core:e,shapeType:"radial",_:y.extend({},e.displayObject._,{start_x:0,start_y:0,end_x:0,end_y:0,x:0,y:0,abs_x:0,abs_y:0}),children:[],set start(t){this._.start_x=t.x+(this.parent&&!this.parent.isCore?this.parent._.abs_x:0),this._.start_y=t.y+(this.parent&&!this.parent.isCore?this.parent._.abs_y:0),this.setPosition()},set end(t){this._.end_x=t.x+(this.parent&&!this.parent.isCore?this.parent._.abs_x:0),this._.end_y=t.y+(this.parent&&!this.parent.isCore?this.parent._.abs_y:0),this.setPosition()},get start(){var t={x:0,y:0};this.parent&&!this.parent.isCore&&(t.x=this.parent._.abs_x,t.y=this.parent._.abs_y);var e=this;return{get x(){return e._.start_x-t.x},get y(){return e._.start_y-t.y},set x(t){e._.start_x=t+(e.parent&&!e.parent.isCore?e.parent._.abs_x:0),e.setPosition()},set y(t){e._.start_y=t+(e.parent&&!e.parent.isCore?e.parent._.abs_y:0),e.setPosition()}}},get end(){var t={x:0,y:0};this.parent&&!this.parent.isCore&&(t.x=this.parent._.abs_x,t.y=this.parent._.abs_y);var e=this;return{get x(){return e._.end_x-t.x},get y(){return e._.end_y-t.y},set x(t){e._.end_x=t+(e.parent&&!e.parent.isCore?e.parent._.abs_x:0),e.setPosition()},set y(t){e._.end_y=t+(e.parent&&!e.parent.isCore?e.parent._.abs_y:0),e.setPosition()}}},set x(t){var e,i,s,r,n;for(e=this._.end_x-this._.start_x,i=this.parent&&!this.parent.isCore?this.parent._.abs_x:0,this._.x=t,this._.abs_x=t+i,this._.start_x=t-e/2+i,this._.end_x=t+e/2+i,r=(s=this.children).length,n=0;n<r;n++)s[n]._.abs_x=this.abs_x+s[n].x,s[n].x+=0},set y(t){var e,i,s,r,n;for(e=this._.end_y-this._.start_y,i=this.parent&&!this.parent.isCore?this.parent._.abs_y:0,this._.y=t,this._.abs_y=t+i,this._.start_y=t-e/2+i,this._.end_y=t+e/2+i,r=(s=this.children).length,n=0;n<r;n++)s[n]._.abs_y=this.abs_y-s[n].y,s[n].y+=0},get x(){return this._.x},get y(){return this._.y},set length(t){var e,i,s,r;e=Math.abs(this._.end_x-this._.start_x),i=Math.abs(this._.end_y-this._.start_y),s=Math.sqrt(e*e+i*i),r=Math.asin(e/s),e=Math.sin(r)*t,i=Math.cos(r)*t,this._.end_x=this._.start_x+e,this._.end_y=this._.start_y+i,this.x+=0,this.y+=0,this.setPosition()},get length(){var t,e,i;return t=Math.abs(this._.end_x-this._.start_x),e=Math.abs(this._.end_y-this._.start_y),i=Math.sqrt(t*t+e*e)},set radius(t){this.length=2*t},get radius(){return this.length/2},setPosition:function(){var t={x:0,y:0};this.parent&&!this.parent.isCore&&(t.x=this.parent._.abs_x,t.y=this.parent._.abs_y),this.x=this._.start_x-t.x+(this._.end_x-this._.start_x)/2,this.y=this._.start_y-t.y+(this._.end_y-this._.start_y)/2},init:function(){this.initialized=!0,this.setPosition()},draw:function(){var t=this.core.canvas,e=this.getOrigin(),i=this.core.draw.translation;return t.lineWidth=this.strokeWidth,t.strokeStyle=this.strokeColor,t.beginPath(),t.moveTo(this._.start_x-i.x-e.x,this._.start_y-i.y-e.y),t.lineTo(this._.end_x-i.x-e.x,this._.end_y-i.y-e.y),t.stroke(),t.closePath(),this}},t)};y.registerDisplayObject("line",O,"init");var M=function(t,e){return y.extend({core:e,shapeType:"rectangular",loaded:!1,firstDrawn:!1,frames:[],duration:0,frame:1,generate:!1,numFrames:0,offset_x:0,offset_y:0,direction:"x",running:!1,active:!1,loop:!0,clipChildren:!1,_:y.extend({},e.displayObject._,{autostart:!1,hasBeenDrawn:!1}),set autostart(t){this.active=t,this._.autostart=t},get autostart(){return this._.autostart},init:function(){if(this.image!==C){var n=this,t=this.image.nodeName&&"img"===this.image.nodeName.toLowerCase();this.img=t?this.image:new Image;var e=function(){var t,e,i,s,r;if(n.full_width=this.width,n.full_height=this.height,n.generate)for(e="y"===(t=n.direction)?n.full_height:n.full_width,i="y"===t?n.height:n.width,0<n.numFrames?s=n.numFrames:(s=e/i,n.numFrames=s),n.frames=[],r=0;r<s;r++)n.frames.push({x:n.offset_x+r*("x"===t?n.width:0),y:n.offset_y+r*("y"===t?n.height:0),d:n.duration});n.loaded=!0,n._.hasBeenDrawn&&n.core.redraw()};t&&this.img.complete?e.call(this.img):(this.img.addEventListener("load",e),t||(this.img.src=this.image))}},draw:function(){var t=this,e=this.core.canvas,i=this.getOrigin(),s=this.abs_x-i.x,r=this.abs_y-i.y,n,a=0,o=0;if(this.loaded){if(0<this.frames.length){if(this.frame>this.frames.length)return this.clipChildren&&(e.beginPath(),e.rect(s,r,0,0),e.closePath(),e.clip()),this;a=(n=this.frames[this.frame-1]).w!==C?n.w:this.width,o=n.h!==C?n.h:this.height,e.drawImage(this.img,n.x,n.y,a,o,s,r,a,o),0<this.strokeWidth&&(e.lineWidth=this.strokeWidth,e.strokeStyle=this.strokeColor,e.strokeRect(s,r,a,o)),!1===this.running&&this.active&&(setTimeout(function(){t.loop?t.frame=t.frame===t.frames.length?1:t.frame+1:t.frame=t.frame===t.frames.length?t.frame:t.frame+1,t.running=!1,t.core.timeline.running||t.core.draw.redraw()},n.d),this.running=!0)}!1===this.firstDrawn&&(this.firstDrawn=!0,clearTimeout(this.loadtimer))}else clearTimeout(this.loadtimer),this.loadtimer=setTimeout(function(){t.draw()},100);return this.clipChildren&&(e.beginPath(),e.rect(s,r,a,o),e.closePath(),e.clip()),this._.hasBeenDrawn=!0,this},start:function(){return this.startAnimation(),this},startAnimation:function(){return this.active=!0,this.core.redraw(),this},stopAnimation:function(){return this.active=!1,this}},t)};y.registerDisplayObject("sprite",M,"init")}(window,document),function(){"use strict";var t=Object.prototype,s=t.__defineGetter__,r=t.__defineSetter__,n=t.__lookupGetter__,a=t.__lookupSetter__,o=t.hasOwnProperty;s&&r&&n&&a&&(Object.defineProperty||(Object.defineProperty=function(t,e,i){if(arguments.length<3)throw new TypeError("Arguments not optional");if(e+="",o.call(i,"value")&&(n.call(t,e)||a.call(t,e)||(t[e]=i.value),o.call(i,"get")||o.call(i,"set")))throw new TypeError("Cannot specify an accessor and a value");return i.get&&s.call(t,e,i.get),i.set&&r.call(t,e,i.set),t}),Object.getOwnPropertyDescriptor||(Object.getOwnPropertyDescriptor=function(t,e){if(arguments.length<2)throw new TypeError("Arguments not optional.");e+="";var i={configurable:!0,enumerable:!0,writable:!0},s=n.call(t,e),r=a.call(t,e);return o.call(t,e)&&(s||r?(delete i.writable,i.get=i.set=void 0,s&&(i.get=s),r&&(i.set=r)):i.value=t[e]),i}),Object.defineProperties||(Object.defineProperties=function(t,e){for(var i in e)o.call(e,i)&&Object.defineProperty(t,i,e[i])}))}();